<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¥æ—¥åºæ›²ï½œä¹å·å±±æµ·è‡ªé§•æ—¥è¨˜ ğŸŒ¸</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap');

        :root {
            --plum: #F06292;        /* æ¢…èŠ±ä¸»è‰² */
            --plum-light: #FCE4EC;
            --ocean: #29B6F6;       /* æµ·æ´‹è— */
            --ocean-dark: #0277BD;
            --mountain: #9CCC65;    /* é˜¿è˜‡ç¶  */
            --text: #37474F;
            --glass: rgba(255, 255, 255, 0.95);
            --gift: #FF9800;        /* ä¼´æ‰‹ç¦®æ©˜ */
            --coupon: #E91E63;      /* å„ªæƒ åˆ¸ç´… */
            --res: #673AB7;         /* é ç´„æ†‘è­‰ç´« */
            --market: #4CAF50;      /* è¶…å¸‚ç¶  */
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background: linear-gradient(160deg, #E1F5FE 0%, #F3E5F5 50%, #F1F8E9 100%);
            margin: 0;
            padding: 20px;
            color: var(--text);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--glass);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.6);
            padding-bottom: 30px;
        }

        /* --- Header --- */
        header {
            background-image: url('https://images.unsplash.com/photo-1522383225653-ed111181a951?q=80&w=2076&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            height: 200px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.4);
            backdrop-filter: blur(1px);
        }

        .header-text {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            color: #D81B60;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.9);
            letter-spacing: 3px;
            font-weight: 800;
        }

        /* Navigation Grid */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
        }

        .nav-btn {
            background: white;
            padding: 18px;
            border-radius: 16px;
            text-align: center;
            font-weight: bold;
            color: var(--text);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:active { transform: scale(0.95); background-color: #f0f0f0; }
        .nav-btn i { font-size: 1.5rem; color: var(--plum); }

        /* Sections */
        .section { display: none; padding: 0 20px; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Back Button */
        .back-btn {
            background: white;
            border: 2px solid var(--ocean-dark);
            color: var(--ocean-dark);
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
        }

        h2 { font-size: 1.4rem; color: var(--plum); border-bottom: 2px dashed #ddd; padding-bottom: 10px; margin-top: 0; }

        /* Collapsible Buttons */
        .collapse-btn {
            width: 100%; background: white; border: none; padding: 15px; margin-bottom: 10px; border-radius: 12px;
            text-align: left; font-family: inherit; font-size: 1.05rem; font-weight: bold; color: var(--text);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            transition: 0.2s;
        }
        .date-btn { border-left: 5px solid var(--ocean); }
        .food-region-btn { border-left: 5px solid var(--plum); }
        .souvenir-btn { border-left: 5px solid var(--gift); }
        .res-btn { border-left: 5px solid var(--res); }
        .market-btn { border-left: 5px solid var(--market); }
        .collapse-btn.active { background: #fdf2f7; color: #D81B60; }
        .collapse-content { display: none; padding: 10px 5px; margin-bottom: 15px; }
        .collapse-content.open { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Supermarket Items */
        .market-item {
            background: white; padding: 15px; margin-bottom: 12px; border-radius: 12px; border-left: 5px solid var(--market);
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); cursor: pointer; position: relative;
        }
        .market-name { font-weight: bold; font-size: 1.05rem; color: #2E7D32; display: block; margin-bottom: 5px; }
        .market-dist { font-size: 0.85rem; color: #FF5722; font-weight: bold; background: #FFEBEE; padding: 2px 6px; border-radius: 4px; margin-right: 5px; }
        .market-feature { font-size: 0.9rem; color: #555; margin-top: 5px; line-height: 1.4; }
        .market-item::after { content: '\f3c5'; font-family: "Font Awesome 5 Free"; font-weight: 900; position: absolute; right: 15px; top: 20px; color: var(--market); opacity: 0.5; }

        /* Souvenir Items */
        .souvenir-item {
            background: white; padding: 15px; margin-bottom: 10px; border-radius: 12px; border-left: 5px solid var(--gift);
            box-shadow: 0 2px 6px rgba(0,0,0,0.05); cursor: pointer; position: relative;
        }
        .souvenir-name { font-weight: bold; font-size: 1.05rem; color: #333; }
        .souvenir-price { color: #D81B60; font-weight: bold; font-size: 0.9rem; margin-left: 8px; }
        .souvenir-loc { font-size: 0.85rem; color: #666; margin-top: 2px; }
        .souvenir-note { font-size: 0.8rem; color: #888; font-style: italic; }
        .souvenir-item::after { content: '\f3c5'; font-family: "Font Awesome 5 Free"; font-weight: 900; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--gift); opacity: 0.5; }

        /* Coupon Card */
        .coupon-card {
            background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; border: 2px dashed var(--coupon); position: relative;
        }
        .coupon-card::before {
            content: 'COUPON'; position: absolute; top: 10px; right: 10px; background: var(--coupon); color: white; padding: 3px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: bold; z-index: 2;
        }
        .coupon-img { width: 100%; height: 180px; object-fit: contain; background: #fafafa; display: block; cursor: pointer; }
        .coupon-info { padding: 15px; text-align: center; border-top: 1px solid #eee; }
        .coupon-title { font-weight: bold; font-size: 1.1rem; }
        .coupon-desc { font-size: 0.9rem; color: #666; margin-top: 5px; }

        /* Timeline & Steps */
        .timeline-step { display: flex; margin-bottom: 15px; padding-left: 10px; position: relative; }
        .timeline-step::before { content: ''; position: absolute; left: 0; top: 8px; bottom: -20px; width: 2px; background: #eee; }
        .timeline-step:last-child::before { display: none; }
        .step-time { font-size: 0.8rem; color: #999; width: 50px; flex-shrink: 0; padding-top: 3px; font-weight: bold; }
        .step-content { background: white; padding: 12px 15px; border-radius: 12px; flex-grow: 1; box-shadow: 0 2px 8px rgba(0,0,0,0.03); border-left: 4px solid var(--mountain); cursor: pointer; position: relative; }
        .step-content::after { content: 'ğŸ“¸'; font-size: 1rem; position: absolute; right: 10px; top: 12px; opacity: 0.6; }
        .res-content { border-left: 4px solid var(--res); }
        .res-content::after { content: 'ğŸ“„'; }

        /* Tags */
        .food-tag { background: white; padding: 10px 14px; border-radius: 20px; font-size: 0.95rem; margin: 0 6px 10px 0; display: inline-block; border: 1px solid #eee; cursor: pointer; border-left: 4px solid var(--plum); }
        
        /* Mapcode Table */
        .map-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        .map-table td { background: white; padding: 12px; border: 1px solid #eee; }
        .map-table td:first-child { border-radius: 10px 0 0 10px; width: 60%; }
        .map-table td:last-child { border-radius: 0 10px 10px 0; text-align: right; }
        .map-link { font-weight: bold; color: var(--ocean-dark); text-decoration: none; display: block; cursor: pointer; font-size: 1.05rem;}
        .copy-btn { background: var(--plum-light); color: var(--plum); border: none; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; cursor: pointer; margin-left: 5px; }
        .parking-card { background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 2px solid #ffb74d; border-radius: 15px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* Calculator */
        .calc-card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .calc-input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 1.2rem; box-sizing: border-box; }
        .calc-result { background: #fff0f5; padding: 20px; border-radius: 15px; margin-top: 10px; border: 2px solid var(--plum); text-align: center; }
        .twd-amount { font-size: 2.5rem; font-weight: 800; color: #D81B60; }

        /* Checklist */
        .checklist-item { background: white; padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; align-items: center; border: 1px solid #f0f0f0; }
        .checklist-item input { margin-right: 15px; width: 20px; height: 20px; accent-color: var(--plum); }
        .checklist-item.checked span { text-decoration: line-through; color: #ccc; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; backdrop-filter: blur(5px); }
        .modal.open { display: flex; }
        .modal-card { background: white; width: 100%; max-width: 400px; border-radius: 20px; overflow: hidden; position: relative; max-height: 80vh; overflow-y: auto; }
        .modal-img { width: 100%; height: auto; max-height: 50vh; object-fit: contain; background: #333; display: block; }
        .modal-body { padding: 20px; }
        .close-modal { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; }

        /* Styles for Timetable & Taxi Card & Lunch Info */
        .timetable { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .timetable th { background: #f0f0f0; padding: 8px; text-align: center; border: 1px solid #ddd; }
        .timetable td { padding: 8px; text-align: center; border: 1px solid #ddd; }
        .warn-text { color: #d32f2f; font-size: 0.9rem; margin-top: 5px; line-height: 1.5; }
        
        .taxi-card { border: 5px solid #000; border-radius: 12px; padding: 25px; background: #fff; text-align: center; margin-top: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .taxi-title { font-size: 1.1rem; color: #555; margin-bottom: 15px; font-weight: bold; border-bottom: 2px dashed #ccc; padding-bottom: 10px; }
        .taxi-big { font-size: 1.8rem; font-weight: 900; line-height: 1.4; color: #000; margin: 15px 0; }
        .taxi-sub { font-size: 0.95rem; color: #333; font-weight: bold; }

        .lunch-card { background: #fff8e1; border: 1px solid #ffe0b2; padding: 15px; border-radius: 10px; text-align:left; }
        .lunch-item { margin-bottom: 10px; }
        .lunch-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px; font-weight: bold; }
        .tag-beef { background: #ffebee; color: #c62828; }
        .tag-no-beef { background: #e8f5e9; color: #2e7d32; }

        /* Tabs */
        .map-tabs { display: flex; background: #f0f0f0; border-radius: 10px; padding: 5px; margin-bottom: 20px; }
        .map-tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-weight: bold; color: #888; border-radius: 8px; }
        .map-tab-btn.active { background: white; color: var(--ocean-dark); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <div class="container">
        <header>
            <div class="header-text">
                <h1>æ˜¥æ—¥åºæ›²</h1>
            </div>
        </header>

        <div id="home" class="section active">
            <div class="nav-grid">
                <div class="nav-btn" onclick="showSection('itinerary')">
                    <i class="fas fa-map-marked-alt"></i> äº’å‹•è¡Œç¨‹è¡¨
                </div>
                <div class="nav-btn" onclick="showSection('packing')">
                    <i class="fas fa-suitcase"></i> æ—…è¡Œæ¸…å–®
                </div>
                <div class="nav-btn" onclick="showSection('food')">
                    <i class="fas fa-utensils"></i> ç¾é£Ÿåœ°åœ–
                </div>
                <div class="nav-btn" onclick="showSection('souvenirs')">
                    <i class="fas fa-gift"></i> ä¼´æ‰‹ç¦®æ¨è–¦
                </div>
                <div class="nav-btn" onclick="showSection('coupons')">
                    <i class="fas fa-ticket-alt"></i> å„ªæƒ åˆ¸
                </div>
                <div class="nav-btn" onclick="showSection('mapcodes')">
                    <i class="fas fa-car-side"></i> å°èˆªç·¨ç¢¼
                </div>
                <div class="nav-btn" onclick="showSection('reservations')">
                    <i class="fas fa-file-invoice"></i> é ç´„æ†‘è­‰
                </div>
                <div class="nav-btn" onclick="showSection('calculator')">
                    <i class="fas fa-calculator"></i> åŒ¯ç‡è¨ˆç®—
                </div>
                <div class="nav-btn" onclick="showSection('supermarkets')">
                    <i class="fas fa-shopping-basket"></i> ä½å®¿å‘¨é‚Šè¶…å¸‚
                </div>
            </div>
            <p style="text-align:center; color:#999; font-size:0.8rem; margin-top:10px;">
                *é»æ“Šè¡Œç¨‹è¡¨ä¸­çš„é …ç›®å¯æŸ¥çœ‹ç…§ç‰‡
            </p>
        </div>

        <div id="supermarkets" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ›’ ä½å®¿å‘¨é‚Šè¶…å¸‚</h2>
            <div id="supermarket-container"></div>
        </div>

        <div id="coupons" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸŸï¸ å„ªæƒ åˆ¸å°ˆå€</h2>
            
            <div class="coupon-card">
                <img src="coupon_daikoku.jpg" class="coupon-img" onclick="openModal('å¤§åœ‹è—¥å¦', 'coupon_daikoku.jpg', 'çµå¸³è«‹å‡ºç¤º')" onerror="this.src='https://via.placeholder.com/300x150?text=å°šæœªä¸Šå‚³+coupon_daikoku.jpg';">
                <div class="coupon-info"><div class="coupon-title">å¤§åœ‹è—¥å¦ (Daikoku)</div><div class="coupon-desc">å…ç¨…10% + 3%~7%</div></div>
            </div>
            <div class="coupon-card">
                <img src="coupon_tsuruha.jpg" class="coupon-img" onclick="openModal('é¶´ç¾½è—¥å¦', 'coupon_tsuruha.jpg', 'çµå¸³è«‹å‡ºç¤º')" onerror="this.src='https://via.placeholder.com/300x150?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
                <div class="coupon-info"><div class="coupon-title">é¶´ç¾½è—¥å¦ (Tsuruha)</div><div class="coupon-desc">å…ç¨…10% + 7%</div></div>
            </div>
            <div class="coupon-card">
                <img src="coupon_matsukiyo.jpg" class="coupon-img" onclick="openModal('æ¾æœ¬æ¸…', 'coupon_matsukiyo.jpg', 'çµå¸³è«‹å‡ºç¤º')" onerror="this.src='https://via.placeholder.com/300x150?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
                <div class="coupon-info"><div class="coupon-title">æ¾æœ¬æ¸… (Matsumoto Kiyoshi)</div><div class="coupon-desc">å…ç¨…10% + 7%</div></div>
            </div>
            <div class="coupon-card">
                <img src="coupon_cosmos.jpg" class="coupon-img" onclick="openModal('Cosmos', 'coupon_cosmos.jpg', 'çµå¸³è«‹å‡ºç¤º')" onerror="this.src='https://via.placeholder.com/300x150?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
                <div class="coupon-info"><div class="coupon-title">Cosmos è—¥å¦</div><div class="coupon-desc">ä¹å·æœ€ä¾¿å®œ</div></div>
            </div>
            <div class="coupon-card">
                <img src="coupon_bic.jpg" class="coupon-img" onclick="openModal('BicCamera', 'coupon_bic.jpg', 'çµå¸³è«‹å‡ºç¤º')" onerror="this.src='https://via.placeholder.com/300x150?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
                <div class="coupon-info"><div class="coupon-title">BicCamera</div><div class="coupon-desc">å…ç¨…10% + 7%</div></div>
            </div>
            <div class="coupon-card">
                <img src="coupon_donki.jpg" class="coupon-img" onclick="openModal('å”å‰è¨¶å¾·', 'coupon_donki.jpg', 'çµå¸³è«‹å‡ºç¤º')" onerror="this.src='https://via.placeholder.com/300x150?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
                <div class="coupon-info"><div class="coupon-title">å”å‰è¨¶å¾· (Don Quijote)</div><div class="coupon-desc">å…ç¨…10% + 5%</div></div>
            </div>
        </div>

        <div id="souvenirs" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ å¿…è²·ä¼´æ‰‹ç¦®</h2>
            <div class="parking-card">
                <div class="parking-title"><i class="fas fa-parking"></i> åšå¤šè»Šç«™ä¸­å¤®åœè»Šå ´</div>
                <div class="parking-info">
                    <div>MapCode: <b>13 320 354*52</b> <button class="copy-btn" onclick="copy('13 320 354*52')">è¤‡è£½</button></div>
                    <div style="margin-top:5px; color:#888;">å„ªæƒ ï¼šæ»¿3000æ—¥åœ“æŠµ1å°æ™‚</div>
                    <div style="margin-top:5px; text-align:right;">
                        <span class="map-link" onclick="openGoogleMap('åšå¤šé§…ä¸­å¤®é§è»Šå ´')" style="cursor:pointer; color:#e65100;">
                            Google Map å°èˆª <i class="fas fa-location-arrow"></i>
                        </span>
                    </div>
                </div>
            </div>
            <div id="souvenir-container"></div>
        </div>

        <div id="packing" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ’ å‡ºç™¼å‰æª¢æŸ¥</h2>
            <div id="checklist-container"></div>
        </div>

        <div id="calculator" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ’´ è³¼ç‰©è¨ˆç®—æ©Ÿ</h2>
            <div class="calc-card">
                <div style="margin-bottom:20px; text-align:left;">
                    <label style="color:#888; font-size:0.9rem;">åŒ¯ç‡ (å¯ä¿®æ”¹)</label>
                    <input type="number" id="rate-input" class="calc-input" value="0.22" step="0.001" style="width:80px; padding:5px;">
                </div>
                <div style="margin-bottom:20px; text-align:left;">
                    <label style="color:#888; font-size:0.9rem;">æ—¥å¹£é‡‘é¡ (Â¥)</label>
                    <input type="number" id="jpy-input" class="calc-input" placeholder="è¼¸å…¥åƒ¹æ ¼...">
                </div>
                <div class="calc-result">
                    <div style="font-size:0.9rem; color:#666;">ç´„åˆå°å¹£ (TWD)</div>
                    <div class="twd-amount" id="twd-output">0</div>
                </div>
            </div>
        </div>

        <div id="itinerary" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ“… æ¯æ—¥è¡Œç¨‹</h2>
            <div id="itinerary-content"></div>
        </div>

        <div id="food" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸœ ç¾é£Ÿåœ°åœ–</h2>
            <div id="food-container"></div>
        </div>

        <div id="mapcodes" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸš— å°èˆªç·¨ç¢¼</h2>
            <div class="map-tabs">
                <button class="map-tab-btn active" onclick="switchMapTab(1)">å±±æ—ç¯‡</button>
                <button class="map-tab-btn" onclick="switchMapTab(2)">æµ·æ´‹ç¯‡</button>
                <button class="map-tab-btn" onclick="switchMapTab(3)">ä½å®¿ç¯‡</button>
                <button class="map-tab-btn" onclick="switchMapTab(4)">ä¼‘æ¯ç«™</button>
            </div>
            <div id="map-page-1"><table class="map-table"><tbody id="map-body-1"></tbody></table></div>
            <div id="map-page-2" style="display:none;"><table class="map-table"><tbody id="map-body-2"></tbody></table></div>
            <div id="map-page-3" style="display:none;"><table class="map-table"><tbody id="map-body-3"></tbody></table></div>
            <div id="map-page-4" style="display:none;"><table class="map-table"><tbody id="map-body-4"></tbody></table></div>
        </div>

        <div id="reservations" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ« é ç´„æ†‘è­‰</h2>
            <button class="collapse-btn res-btn" onclick="toggleAccordion(0, 'res-hotel', 'res-btn')"><span>ğŸ¨ ä½å®¿æ†‘è­‰</span><i class="fas fa-chevron-down"></i></button>
            <div id="res-hotel-0" class="collapse-content res-hotel"></div>
            
            <button class="collapse-btn res-btn" onclick="toggleAccordion(1, 'res-other', 'res-btn')"><span>ğŸ« äº¤é€šèˆ‡æ´»å‹•</span><i class="fas fa-chevron-down"></i></button>
            <div id="res-other-1" class="collapse-content res-other"></div>
        </div>
    </div>

    <div id="location-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-card">
            <button class="close-modal" onclick="closeModal(event)">Ã—</button>
            <img id="modal-img" class="modal-img" src="">
            <div class="modal-body">
                <h3 id="modal-title"></h3>
                <div id="modal-desc" style="color:#666;"></div>
            </div>
        </div>
    </div>

<script>
    // --- 1. Global Helper: Google Maps (Fixed & Robust) ---
    function openGoogleMap(query) {
        const encodedQuery = encodeURIComponent(query);
        const url = `https://www.google.com/maps/search/?api=1&query=${encodedQuery}`;
        window.open(url, '_blank');
    }

    // --- HTML Content for 1/30 Train Timetable ---
    const jrTimetableHTML = `
        <div style="text-align:left; font-size:0.95rem;">
            <p style="background:#e3f2fd; padding:10px; border-radius:8px; margin-bottom:15px;">
                âœ… <b>ä½¿ç”¨ ICOCA ç›´æ¥åˆ·å¡é€²ç«™</b><br>
                âœ¨ <b>ç›®æ¨™ç­æ¬¡ï¼š08:08 å¿«é€Ÿ</b>
            </p>
            <table class="timetable">
                <tr style="background:#eee;"><th>åšå¤šç™¼</th><th>é¦™æ¤æŠµ</th><th>è»Šç¨®</th></tr>
                <tr><td>07:59</td><td>08:13</td><td>æ™®é€š (æ…¢)</td></tr>
                <tr style="background:#e8f5e9; font-weight:bold; color:#2e7d32; font-size:1.1rem;"><td>08:08</td><td>08:20</td><td>å¿«é€Ÿ (æ¨)</td></tr>
                <tr><td>08:14</td><td>08:28</td><td>æ™®é€š</td></tr>
                <tr><td>08:17</td><td>08:31</td><td>æ™®é€š</td></tr>
            </table>
            <div class="warn-text" style="background:#ffebee; padding:10px; border-radius:8px; margin-top:15px;">
                âš ï¸ <b>é¿é–‹é™·é˜±è»Šæ¬¡ï¼š</b><br>
                âŒ 08:02 ç‰¹æ€¥ Sonic (éœ€åŠ éŒ¢)<br>
                âŒ 08:05, 08:26 (åªåˆ°å‰å¡š)
            </div>
            <p style="margin-top:15px; font-size:0.9rem;">
                <b>ğŸ”„ é¦™æ¤ç«™è½‰ä¹˜ï¼š</b><br>
                æŠµé”é¦™æ¤å¾Œï¼Œè«‹æ›æœˆå°æ­ä¹˜ã€ŒJRé¦™æ¤ç·š (å¾€è¥¿æˆ¶å´)ã€ã€‚08:08é‚£ç­æ¥08:39çš„å°ç«è»Šï¼Œè½‰ä¹˜æ™‚é–“ç´„19åˆ†é˜ï¼Œéå¸¸å……è£•ã€‚
            </p>
        </div>
    `;

    // --- HTML Content for Taxi Card (Driver Card - Large Text) ---
    const taxiCardHTML = `
        <div class="taxi-card">
            <div class="taxi-title">é‹è»¢æ‰‹ã•ã‚“ã¸ (To Driver)</div>
            <div class="taxi-big">
                è¥¿é‰„ãƒ›ãƒ†ãƒ« ã‚¯ãƒ«ãƒ¼ãƒ <br>åšå¤šç¥‡åœ’ æ«›ç”°ç¥ç¤¾å‰
            </div>
            <div class="taxi-sub">
                Nishitetsu Hotel Croom<br>Hakata Gion Kushida Shrine
            </div>
        </div>
    `;

    // --- HTML Content for Aso Lunch (New Kusasenri) ---
    const lunchAsoHTML = `
        <div class="lunch-card">
            <h4 style="margin-top:0; color:#333;">New Kusasenri æ™¯è§€é¤å»³</h4>
            <p style="font-size:0.9rem; color:#666;">ä½æ–¼è‰åƒé‡Œåœè»Šå ´æ­£å‰æ–¹ï¼Œç©ºé–“å¤§ã€‚</p>
            <hr style="border:0; border-top:1px dashed #ccc; margin:10px 0;">
            
            <div class="lunch-item">
                <span class="lunch-tag tag-beef">åƒç‰›æ¨è–¦</span>
                <span style="font-weight:bold;">é˜¿è˜‡èµ¤ç‰›ä¸¼ (Akaushi Don)</span>
                <div style="font-size:0.85rem; color:#555;">å¿…åƒåç‰©ï¼åŠç†Ÿç´…ç‰›è‚‰é‹ªæ»¿ã€‚</div>
            </div>

            <div class="lunch-item">
                <span class="lunch-tag tag-no-beef">ä¸åƒç‰›æ¨è–¦</span>
                <span style="font-weight:bold;">ç‚¸è±¬æ’å’–å“© (Tonkatsu Curry)</span>
                <div style="font-size:0.85rem; color:#555;">ä»½é‡è¶³å¤ ï¼Œæ—¥å¼å£å‘³ã€‚</div>
            </div>

            <div class="lunch-item">
                <span class="lunch-tag tag-no-beef">ä¸åƒç‰›æ¨è–¦</span>
                <span style="font-weight:bold;">å¤ªå¹³ç‡• (Tai-pi-en)</span>
                <div style="font-size:0.85rem; color:#555;">ç†Šæœ¬ç‰¹è‰²æµ·é®®å†¬ç²‰æ¹¯ï¼Œæ¸…çˆ½å¥½åƒã€‚</div>
            </div>
            
            <div style="margin-top:15px; font-size:0.85rem; color:#888;">
                å‚™æ¡ˆï¼šè‹¥äººå¤ªå¤šï¼Œå¯æ”¹å»å±±ä¸‹çš„ã€Œé˜¿è˜‡è·¯ã€åƒé«˜èœé£¯å®šé£Ÿã€‚
            </div>
        </div>
    `;

    // --- 2. Data Definitions ---
    
    // Supermarket Data (Fixed query keys for accuracy)
    const supermarketData = [
        {
            hotel: "ğŸ¨ ä½å®¿1: ä¸‰äº•èŠ±åœ’ä¸­æ´²",
            shops: [
                { name: "Reganet Cute ä¸­æ´²å·ç«¯åº—", addr: "12-20 Kamikawabatamachi, Hakata Ward, Fukuoka, 812-0026æ—¥æœ¬", dist: "æ­¥è¡Œ 2 åˆ†", feat: "åœ°éµå…±æ§‹ï¼Œå›é£¯åº—é †è·¯" },
                { name: "Foodway ä¸­æ´²é£Ÿå°ç”ºåº—", addr: "ç¦å²¡å¸‚åšå¤šåŒºä¸­æ´² 3-7-24", dist: "æ­¥è¡Œ 3 åˆ†", feat: "Gate'så¤§æ¨“å…§ï¼Œé–‹å¾ˆæ™š" },
                { name: "Don Quijote å”å‰è¨¶å¾· ä¸­æ´²åº—", addr: "ãƒ‰ãƒ³ãƒ»ã‚­ãƒ›ãƒ¼ãƒ† ä¸­æ´²åº—", dist: "æ­¥è¡Œ 3 åˆ†", feat: "24Hï¼Œé›¶é£Ÿé›œè²¨å…¨æœ‰" },
                { name: "MaxValu Express åšå¤šç¥‡åœ’åº—", addr: "7-20 Gionmachi, Hakata Ward, Fukuoka, 812-0038æ—¥æœ¬", dist: "æ­¥è¡Œ 10 åˆ†", feat: "24H æ¨™æº–è¶…å¸‚" },
                { name: "å¤§ä¸¸ç¦å²¡å¤©ç¥åº— åœ°ä¸‹é£Ÿå“è¡—", addr: "1 Chome-4-1 Tenjin, Chuo Ward, Fukuoka, 810-8717æ—¥æœ¬", dist: "æ­¥è¡Œ 8 åˆ†", feat: "é«˜ç´šæ°´æœã€å’Œç‰›" }
            ]
        },
        {
            hotel: "ğŸ¨ ä½å®¿2: è¥¿éµ Croom ç¥‡åœ’",
            shops: [
                { name: "MaxValu Express åšå¤šç¥‡åœ’åº—", addr: "7-20 Gionmachi, Hakata Ward, Fukuoka, 812-0038æ—¥æœ¬", dist: "æ­¥è¡Œ 3 åˆ†", feat: "é£¯åº—æ–œå°é¢ï¼Œ24Hæœ€æ–¹ä¾¿" },
                { name: "Lopia åšå¤šYodobashiåº—", addr: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…ä¸­å¤®è¡— 6-12", dist: "æ­¥è¡Œ 12 åˆ†", feat: "é«˜CPå€¼ï¼Œè‚‰ä¾¿å®œ (åªæ”¶ç¾é‡‘)" },
                { name: "åšå¤šé˜ªæ€¥ åœ°ä¸‹é£Ÿå“è¡—", addr: "1-1 Hakataekichuogai, Hakata Ward, Fukuoka, 812-0012æ—¥æœ¬", dist: "æ­¥è¡Œ 10 åˆ†", feat: "é«˜ç´šç†Ÿé£Ÿä¾¿ç•¶" },
                { name: "Reganet Cute ä¸­æ´²å·ç«¯åº—", addr: "12-20 Kamikawabatamachi, Hakata Ward, Fukuoka, 812-0026æ—¥æœ¬", dist: "æ­¥è¡Œ 8 åˆ†", feat: "ä½æ–¼å·ç«¯å•†åº—è¡—å°¾ç«¯ï¼Œé€›è¡—æ™‚å¯é †é“æ¡è²·" },
                { name: "Bon Repas ç™¾æ—¬é¤¨", addr: "1 Chome-11-16 Watanabedori, Chuo Ward, Fukuoka, 810-0004æ—¥æœ¬", dist: "æ­¥è¡Œ 15 åˆ†", feat: "åœ¨åœ°é«˜ç´šè¶…å¸‚" }
            ]
        },
        {
            hotel: "ğŸ¨ ä½å®¿3: Dormy Inn ç†Šæœ¬",
            shops: [
                { name: "Foodway SAKURA MACHIåº—", addr: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºæ¡œç”º 3-10", dist: "æ­¥è¡Œ 2 åˆ†", feat: "é£¯åº—å°é¢åœ°ä¸‹1æ¨“ï¼Œæ–°ç©" },
                { name: "æ¥­å‹™è¶…å¸‚ è¾›å³¶å…¬åœ’åº—", addr: "2-1 Karashimacho, Chuo Ward, Kumamoto, 860-0804æ—¥æœ¬", dist: "æ­¥è¡Œ 1 åˆ†", feat: "å¤§åŒ…è£é›¶é£Ÿä¾¿å®œ" },
                { name: "Miyahara ä¸‹é€šåº—", addr: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºèŠ±ç•‘ç”º 11-14", dist: "æ­¥è¡Œ 5 åˆ†", feat: "åƒè¶…å•†çš„ç”Ÿé®®è¶…å¸‚" },
                { name: "Don Quijote ç†Šæœ¬ä¸‹é€šåº—", addr: "ç†Šæœ¬å¸‚ä¸­å¤®åŒºå®‰æ”¿ç”º 5-27", dist: "æ­¥è¡Œ 6 åˆ†", feat: "24H è£œè²¨é¦–é¸" },
                { name: "é¶´å±‹ç™¾è²¨åº— åœ°ä¸‹é£Ÿå“è¡—", addr: "6-1 Tetorihoncho, Chuo Ward, Kumamoto, 860-0808æ—¥æœ¬", dist: "æ­¥è¡Œ 10 åˆ†", feat: "ç†Šæœ¬æœ€é«˜ç´šç™¾è²¨" }
            ]
        }
    ];

    // Souvenir Data
    const souvenirData = [
        {
            category: "ğŸ§‚ èª¿å‘³æ–™ / é¹¹é£Ÿé¡",
            items: [
                { name: "è»Ÿç®¡æ˜å¤ªå­é†¬", price: "Â¥756", loc: "Maing ååº—è¡—", note: "é…é£¯ç¥ç‰©" },
                { name: "èŒ…ä¹ƒèˆé«˜æ¹¯åŒ…", price: "Â¥2,268", loc: "Deitos 1F", note: "é€ç¦®é¦–é¸" },
                { name: "æ˜å¤ªå­ä»™è²", price: "Â¥540", loc: "Maing", note: "ç¶“å…¸é¹¹é£Ÿ" },
                { name: "é’æŸšå­èƒ¡æ¤’", price: "Â¥432", loc: "Maing", note: "æ²¾è‚‰çµ•é…" },
                { name: "Calbee æ˜å¤ªå­è–¯æ¢", price: "Â¥900", loc: "Maing", note: "åˆ†é£Ÿæ–¹ä¾¿" },
                { name: "å…«å¥³èŒ¶", price: "Â¥1,080", loc: "Maing", note: "é«˜ç´šç¶ èŒ¶" }
            ]
        },
        {
            category: "ğŸ° ç”œé» / è›‹ç³•é¡",
            items: [
                { name: "ç¦ç ‚å±‹ é•·å´è›‹ç³•", price: "Â¥1,458", loc: "Maing", note: "åº•éƒ¨ç²—ç³–" },
                { name: "åšå¤šé€šé¥…é ­", price: "Â¥730", loc: "Maing", note: "å¥¶é¦™æ¿ƒéƒ" },
                { name: "Sugar Butter Sand Tree", price: "Â¥993", loc: "åšå¤šé˜ªæ€¥ B1F", note: "ç”˜ç‹è‰è“å£å‘³" },
                { name: "ä¼Šéƒ½ King è‰è“éŠ…é‘¼ç‡’", price: "Â¥565", loc: "Maing", note: "å«æ•´é¡†è‰è“" },
                { name: "å—è »å¾€ä¾†", price: "Â¥670", loc: "Maing", note: "é…¥è„†æä»" },
                { name: "ç­‘ç´«éº»ç³¬", price: "Â¥540", loc: "Maing", note: "é™„é»‘ç³–èœœ" },
                { name: "æ²»ä¸€éƒå¸ƒä¸", price: "Â¥420", loc: "JRåšå¤šåŸ 1F", note: "è›‹é¦™æ¿ƒéƒ" }
            ]
        },
        {
            category: "ğŸª é¤…ä¹¾ / å°é»å¿ƒ",
            items: [
                { name: "äºŒâ—‹åŠ ç…é¤…", price: "Â¥648", loc: "Maing", note: "é™„æç¬‘é¢å…·" },
                { name: "Tirolian æ²å¿ƒé…¥", price: "Â¥540", loc: "Maing", note: "å¾©å¤éµç½" },
                { name: "åšå¤šç”œè–¯ç‡’", price: "Â¥648", loc: "Maing", note: "ç¶¿å¯†åœ°ç“œ" },
                { name: "åšå¤šç´…è‰è“é¤…ä¹¾", price: "Â¥777", loc: "Maing", note: "è‰è“å¤¾å¿ƒ" },
                { name: "å°é›é¥…é ­", price: "Â¥1,194", loc: "Maing", note: "ç¶“å…¸" },
                { name: "åšå¤šä¹‹å¥³", price: "Â¥389", loc: "Maing", note: "å¹´è¼ªè›‹ç³•" }
            ]
        }
    ];

    // Itinerary (Updated with Taxi Card)
    const itineraryData = [
        { date: "1/29 (å››) Day 1", steps: [
            { t: "12:00", name: "ç¦å²¡æ©Ÿå ´æŠµé”", image: "day1_airport.jpg", desc: "CI138 æŠµé”" },
            { t: "14:00", name: "å·ç«¯é€šå•†åº—è¡—", image: "day1_kawabata.jpg", desc: "å¤è€å•†åº—è¡—" },
            { t: "15:00", name: "Full Full æ˜å¤ªå­éºµåŒ…", image: "day1_fullfull.jpg", desc: "å¿…åƒæ³•æ£" },
            { t: "18:00", name: "è—¥é™¢ç‡’è‚‰ NIKUICHI", image: "day1_nikuichi.jpg", desc: "å·²é ç´„ CPå€¼é«˜" },
            { t: "20:00", name: "è¥¿éµ Croom åšå¤šç¥‡åœ’", image: "day1_hotel.jpg", desc: "å¤§æµ´å ´" }
        ]},
        { date: "1/30 (äº”) Day 2", steps: [
            { t: "08:00", name: "é£¯åº—å‡ºç™¼ â” åšå¤šç«™", image: "day2_start.jpg", desc: "æ­¥è¡Œ(12åˆ†)æˆ–åœ°éµ(1ç«™)è‡³JRåšå¤šç«™ã€‚" },
            { t: "08:08", name: "æ­ä¹˜ JR (æŸ¥çœ‹æ™‚åˆ»è¡¨)", image: "day2_train.jpg", desc: "é»æ“ŠæŸ¥çœ‹ 08:00-09:00 è©³ç´°ç­æ¬¡èˆ‡ ICOCA æ”»ç•¥", isHtml: true, htmlContent: jrTimetableHTML },
            { t: "09:30", name: "æµ·ä¹‹ä¸­é“æµ·æ¿±å…¬åœ’", image: "day2_park.jpg", desc: "â˜…å¿…ç§Ÿè…³è¸è»Šã€‚æ¨è–¦ï¼šå‹•ç‰©ä¹‹æ£®(æ°´è±š/è¢‹é¼ )ã€‚åˆé¤æ–¼åœ’å…§è§£æ±ºã€‚" },
            { t: "15:00", name: "æ¸¡è¼ª (å¾€ç™¾é“æ¿±)", image: "day2_ferry.jpg", desc: "ã€é—œéµæ™‚åˆ»ã€‘15:00ç™¼èˆ¹(å®‰ç”°æ±½èˆ¹)ã€‚è«‹é ç•™æ™‚é–“é‚„è»Šä¸¦èµ°åˆ°ç¢¼é ­ã€‚ç¥¨åƒ¹Â¥1200ã€‚" },
            { t: "15:30", name: "ç¦å²¡å¡” & æµ·ç˜", image: "day2_tower.jpg", desc: "ç™¾é“æ¿±æ²™ç˜æ‹ç…§ â” ç™»ç¦å²¡å¡”(è­·ç…§æœ‰å„ªæƒ )ã€‚" },
            { t: "17:00", name: "MARK IS (æ™šé¤)", image: "day2_dinner.jpg", desc: "ä½æ–¼ç¦å²¡å¡”æ­£å°é¢ï¼ŒäºŒæ¨“æœ‰ç©ºæ©‹é€£æ¥ã€‚<br>æ¨è–¦ï¼šå¤©å©¦ç¾…Takaoã€é‡‘å­åŠä¹‹åŠ©ã€è¥¿æ–°åˆå–œã€‚" },
            { t: "20:00", name: "è¨ˆç¨‹è»Šå›é£¯åº— (å‡ºç¤ºå¸æ©Ÿ)", image: "", desc: "é»æ“Šé¡¯ç¤ºçµ¦å¸æ©Ÿçœ‹çš„ã€é£¯åº—åœ°å€å¡ã€‘(å¤§å­—é«”+é»‘æ¡†)", isHtml: true, htmlContent: taxiCardHTML }
        ]},
        { date: "1/31 (å…­) Day 3", steps: [
            { t: "09:00", name: "Toyota Rent a Car", image: "day3_car.jpg", desc: "åšå¤šç«™æ±å–è»Š" },
            { t: "11:30", name: "ULUU è‰è“åƒåˆ°é£½", image: "day3_strawberry.jpg", desc: "ä½è³€" },
            { t: "15:00", name: "ç”±å¸ƒé™¢ æ¹¯ä¹‹åª", image: "day3_yufuin.jpg", desc: "ç«¥è©±æ‘" },
            { t: "18:30", name: "æ¹¯å¸ƒé™¢å±±æ°´é¤¨", image: "day3_sansuikan.jpg", desc: "éœ²å¤©æº«æ³‰" }
        ]},
        { date: "2/1 (æ—¥) Day 4", steps: [
            { t: "08:00", name: "é‡‘é±—æ¹–", image: "day4_lake.jpg", desc: "æ™¨éœ§" },
            { t: "09:30", name: "å¤§è§€å³°", image: "day4_daikanbo.jpg", desc: "360åº¦ä¿¯ç°é˜¿è˜‡ç«å±±" },
            { t: "11:00", name: "è‰åƒé‡Œ (åˆé¤)", image: "day4_lunch.jpg", desc: "é»æ“ŠæŸ¥çœ‹ã€New Kusasenri èœå–®æ”»ç•¥ã€‘(å«ä¸åƒç‰›å»ºè­°)", isHtml: true, htmlContent: lunchAsoHTML },
            { t: "13:00", name: "é˜¿è˜‡ä¸­å²³ç«å£", image: "day4_crater.jpg", desc: "æ´»ç«å±±å£å†’ç…™ (è¦–ç“¦æ–¯æ¿ƒåº¦é–‹æ”¾)" },
            { t: "14:30", name: "ç™½å·æ°´æº", image: "day4_water.jpg", desc: "æ¸…æ¾ˆæ¹§æ³‰ï¼Œå¯è£æ°´" },
            { t: "15:30", name: "ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾", image: "day4_shrine.jpg", desc: "é€šå¾€ç•°ä¸–ç•Œçš„å…¥å£ (éœ€çˆ¬æ¨“æ¢¯)" },
            { t: "18:00", name: "Dormy Inn ç†Šæœ¬", image: "day4_dormy.jpg", desc: "æŠµé”é£¯åº—ï¼Œæ™šä¸Šæœ‰å…è²»æ‹‰éºµ" }
        ]},
        { date: "2/2 (ä¸€) Day 5", steps: [
            { t: "11:30", name: "å¤©è‰æµ·é®®è”µ", image: "day5_dolphin.jpg", desc: "çœ‹æµ·è±š + BBQ" },
            { t: "18:00", name: "ç†Šæœ¬ä¸‹é€šå•†åº—è¡—", image: "day5_shopping.jpg", desc: "é€›è¡—" }
        ]},
        { date: "2/3 (äºŒ) Day 6", steps: [
            { t: "10:00", name: "ç†Šæœ¬åŸ", image: "day6_castle.jpg", desc: "å¤©å®ˆé–£" },
            { t: "13:00", name: "Kyoho Winery (å·¨å³°è‘¡è„é…’å» )", image: "day6_winery.jpg", desc: "æ£®æ—ä¸­çš„é…’èŠï¼Œå¯åƒè§€èˆ‡è©¦é£²ã€‚(è‹¥æ™‚é–“å……è£•çš„é¸é …)" },
            { t: "15:00", name: "å¤ªå®°åºœå¤©æ»¿å®®", image: "day6_dazaifu.jpg", desc: "æ¢…æé¤…" },
            { t: "19:00", name: "ä¸‰äº•èŠ±åœ’ä¸­æ´²", image: "day6_hotel.jpg", desc: "è³ªæ„Ÿé£¯åº—" }
        ]},
        { date: "2/4 (ä¸‰) Day 7", steps: [
            { t: "09:00", name: "å‘¼å­æœå¸‚", image: "day7_squid.jpg", desc: "æ´»èŠ±æ" },
            { t: "14:00", name: "ç³¸å³¶ å¤«å©¦å²©", image: "day7_itoshima.jpg", desc: "ç™½è‰²é³¥å±…" }
        ]},
        { date: "2/5 (å››) Day 8", steps: [
            { t: "All Day", name: "THE OUTLETS", image: "day8_outlets.jpg", desc: "åŒ—ä¹å·æœ€å¤§" },
            { t: "18:00", name: "é‚„è»Š", image: "day8_returncar.jpg", desc: "åšå¤šç«™æ±" }
        ]},
        { date: "2/6 (äº”) Day 9", steps: [
            { t: "ä¸Šåˆ", name: "å‰å¾€æ©Ÿå ´", image: "day9_home.jpg", desc: "CI139 å›å®¶" }
        ]}
    ];

    // Food
    const foodData = [
        { region: "åšå¤š", items: ["Full Full æ˜å¤ªå­éºµåŒ…", "è—¥é™¢ç‡’è‚‰ NIKUICHI", "ä¸€é›™æ‹‰éºµ", "å‰å¡šé°»é­šå±‹", "åŠªåŠªé›", "åšå¤šä¸€å£é¤ƒå­"] },
        { region: "å¤©ç¥", items: ["I'm donut?", "Shin Shin æ‹‰éºµ", "è‘«è˜†å£½å¸", "å…ƒç¥–åšå¤šã‚ã‚“ãŸã„é‡", "å£½å¸éƒ", "æ•˜æ•˜è‹‘ éŠç„äº­", "BAKE CHEESE TART"] },
        { region: "ç”±å¸ƒé™¢", items: ["B-Speak è›‹ç³•æ²", "è±å¾Œç‰›å¯æ¨‚é¤…", "é‡œé£¯å¿ƒ", "Milch èµ·å¸è›‹ç³•", "èŠ±éº´èŠå®¶", "é‡‘è³å¯æ¨‚é¤…"] },
        { region: "ç†Šæœ¬", items: ["é»‘äº­æ‹‰éºµ", "å‹çƒˆäº­ç‚¸è±¬æ’", "èœ‚æ¨‚é¥…é ­", "è…ä¹ƒå±‹ é¦¬è‚‰", "ç´…è˜­äº­ å¤ªå¹³ç‡•", "èŠ¥æœ«è“®è—•"] },
        { region: "é˜¿è˜‡/ä½è³€", items: ["New Kusasenri (æ™¯è§€é¤å»³)", "é˜¿è˜‡è·¯ (é«˜èœé£¯)", "Imakin èµ¤ç‰›ä¸¼", "æ²³å¤ªéƒ æ´»èŠ±æ", "ç³¸å³¶å¸ƒä¸", "é˜¿è˜‡ã¨ã‚Šå®®", "ä½è³€ç‰› å­£æ¨‚"] }
    ];

    // Mapcodes (Separate Arrays for Tabs with Parking Priority)
    const mapMountain = [
        { n: "å¤§è§€å³° (ç¬¬1åœè»Šå ´)", c: "256 878 352*78", p: "0967-32-1960", addr: "æ—¥æœ¬ã€’869-2313 Kumamoto, Aso, Yamada, å¤§è¦³å³° ç¬¬1é§è»Šå ´" },
        { n: "New Kusasenri (æ™¯è§€é¤å»³)", c: "256 456 770*13", p: "0967-34-0131", addr: "New Kusasenri" },
        { n: "é˜¿è˜‡ç«å±±å£ (é¿é›£ä¼‘æ†©æ‰€åœè»Šå ´)", c: "256 427 493*15", p: "0967-34-1600", addr: "é˜¿è˜‡ç«å±±ç«å£é¿é›£ä¼‘æ†©æ‰€åœè»Šå ´" }, 
        { n: "ç™½å·æ°´æº (ç¬¬1é§è»Šå ´)", c: "256 251 380*16", p: "0967-62-0318", addr: "ç™½å·æ°´æº ç¬¬ï¼‘é§è»Šå ´" },
        { n: "ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾ (åƒæ‹œè€…åœè»Šå ´)", c: "256 221 723*74", p: "-", addr: "ä¸Šè‰²è¦‹ç†Šé‡åº§ç¥ç¤¾ å‚æ‹è€…é§è»Šå ´" },
        { n: "é˜¿è˜‡è·¯ (å‚™ç”¨åˆé¤)", c: "256 657 512*44", p: "0967-35-0924", addr: "Asoji" },
        { n: "é‡‘é±—æ¹–åœè»Šå ´", c: "269 359 583*03", p: "0977-84-3111", addr: "Kinrin Lake Parking" },
        { n: "Imakin é£Ÿå ‚", c: "256 685 024*41", p: "0967-32-0031", addr: "Imakin Shokudo" }
    ];

    const mapOcean = [
        { n: "Toyota Rent a Car (åšå¤šç«™æ±)", c: "13 320 188*71", p: "092-472-8388", addr: "1 Chome-4-10 Toko, Hakata Ward, Fukuoka, 812-0008" },
        { n: "Uluu Gardens SAGA (è‰è“åœ’)", c: "37 491 662*13", p: "0942-27-6400", addr: "Uluu Gardens SAGA ä½è³€çœŒä¸‰é¤ŠåŸºéƒ¡ã¿ã‚„ãç”ºæ±Ÿå£7079" },
        { n: "Kyoho Winery (å·¨å³°è‘¡è„é…’å» )", c: "166 548 266*73", p: "0943-72-2382", addr: "246-1 Tanushimarumachi Masuoda, Kurume, Fukuoka 839-1213æ—¥æœ¬" },
        { n: "å¤©è‰æµ·é®®è”µ (éŠå®¢ä¸­å¿ƒ)", c: "254 755 461*27", p: "0969-52-7707", addr: "Amakusa Kaisenkura" },
        { n: "ç†Šæœ¬åŸ (åŸå½©è‹‘åœè»Šå ´)", c: "29 459 342*58", p: "096-352-5900", addr: "Sakuranobaba Josaien" },
        { n: "å¤ªå®°åºœ (åƒå¾³é§è»Šå ´)", c: "55 364 128*27", p: "092-922-8225", addr: "åƒå¾³é§è»Šå ´" },
        { n: "å‘¼å­æœå¸‚ (Yobukofureai P)", c: "182 692 890*43", p: "0955-82-3426", addr: "Yobuko Morning Market" },
        { n: "ç³¸å³¶ å¤«å©¦å²© (åœè»Šå ´)", c: "224 788 206*25", p: "092-327-0317", addr: "Sakurai Futamigaura of Itoshima" },
        { n: "THE OUTLETS", c: "16 427 590*78", p: "093-663-7251", addr: "THE OUTLETS KITAKYUSHU" }
    ];

    const mapHotels = [
        { n: "è¥¿éµé£¯åº— Croom åšå¤šç¥‡åœ’", c: "13 318 624*25", p: "092-235-5050", addr: "6-30 Gionmachi, Hakata Ward, Fukuoka, 812-0038" },
        { n: "æ¹¯å¸ƒé™¢å±±æ°´é¤¨", c: "269 328 633*45", p: "0977-84-2101", addr: "Yufuin Sansuikan" },
        { n: "Dormy Inn ç†Šæœ¬", c: "29 459 487*36", p: "096-311-5489", addr: "Dormy Inn Kumamoto Natural Hot Spring" },
        { n: "ä¸‰äº•èŠ±åœ’é£¯åº—ç¦å²¡ä¸­æ´²", c: "13 318 803*40", p: "092-263-5531", addr: "æ—¥æœ¬ã€’810-0801 Fukuoka, Hakata Ward, Nakasu, 5 Chomeâˆ’5âˆ’1 ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ä¸­å· ï¼‘F" }
    ];

    const mapRest = [
        { n: "å±±ç”°SA (é«˜é€Ÿ-ä¸‹è¡Œ)", c: "55 330 675*44", p: "-", addr: "Yamada Service Area (Down)", desc: "ğŸŒ» ç¶ è‰²ä¼‘æ¯ç«™ï¼šäººæ°£éºµåŒ…åº—ã€å‘æ—¥è‘µç”°ã€æœå€‰è”¥æ²¹æ·‹é›" },
        { n: "é“ä¹‹é©› æµ®ç¾½ (Ukiha)", c: "166 385 410*55", p: "0943-77-2933", addr: "Michinoeki Ukiha", desc: "ğŸ¥‡ ä¹å·ç¬¬ä¸€åï¼šæ°´æœç‹åœ‹(è‰è“/æŸ¿å­)ã€å¯ä¿¯ç°å¹³åŸç¾æ™¯" },
        { n: "åŒ—ç†Šæœ¬SA (é«˜é€Ÿ-ä¸Šè¡Œ)", c: "29 646 648*14", p: "-", addr: "Kitakumamoto Service Area (Up)", desc: "ğŸ» ç†Šæœ¬ç†Šå¤§æœ¬ç‡Ÿï¼šå‘¨é‚Šå•†å“æœ€é½Šå…¨ã€ç†Šæœ¬æ‹‰éºµã€è§’ç…®é¥…é ­" },
        { n: "å»£å·SA (é«˜é€Ÿ-ä¸Šè¡Œ)", c: "37 021 685*82", p: "-", addr: "Hirokawa Service Area (Up)", desc: "ğŸµ å…«å¥³èŒ¶ç”¢åœ°ï¼šæŠ¹èŒ¶ç”œé»è±å¯Œã€å¤§å‹å•†å ´ç´šä¼‘æ¯ç«™" },
        { n: "é“ä¹‹é©› ä¹…ç•™ç±³ (Kurume)", c: "37 363 487*44", p: "0942-47-4111", addr: "Michinoeki Kurume", desc: "ğŸ‡ è¾²æ¥­ç”¢å€¼æœ€é«˜ï¼šä¹…ç•™ç±³æ‹‰éºµã€çƒ¤é›è‚‰ä¸²ã€æ–°é®®è¾²ç”¢" }
    ];

    // Reservations
    const hotelRes = [
        { t: "åšå¤šé£¯åº— (è¥¿éµ)", d: "1/29 - 1/31", image: "res_hotel_hakata.jpg" },
        { t: "ç”±å¸ƒé™¢é£¯åº— (å±±æ°´é¤¨)", d: "1/31", image: "res_hotel_yufuin.jpg" },
        { t: "ç†Šæœ¬é£¯åº— (Dormy)", d: "2/1 - 2/3", image: "res_hotel_kumamoto.jpg" },
        { t: "ä¸­æ´²é£¯åº— (ä¸‰äº•)", d: "2/3 - 2/6", image: "res_hotel_nakasu.jpg" }
    ];
    const otherRes = [
        { t: "âœˆï¸ æ©Ÿç¥¨ (è¯èˆª)", d: "1/29 & 2/6", image: "res_flight.jpg" },
        { t: "ğŸš— ç§Ÿè»Š (Toyota)", d: "1/31 - 2/5", image: "res_car.jpg" },
        { t: "ğŸ“ è‰è“åƒåˆ°é£½", d: "1/31 11:30", image: "res_strawberry.jpg" },
        { t: "ğŸ¥© è—¥é™¢ç‡’è‚‰", d: "1/29 æ™šé¤", image: "res_yakiniku.jpg" },
        { t: "ğŸ¬ å¤©è‰æµ·è±š", d: "2/2 11:30", image: "res_dolphin.jpg" }
    ];

    // --- 3. Rendering Functions ---

    function showSection(id) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }

    function toggleAccordion(idx, className, btnClass) {
        const content = document.getElementById(`${className}-${idx}`);
        const btn = document.getElementsByClassName(btnClass)[idx];
        const isOpen = content.classList.contains('open');
        
        document.querySelectorAll('.' + className).forEach(e => e.classList.remove('open'));
        document.querySelectorAll('.' + btnClass).forEach(e => e.classList.remove('active'));

        if(!isOpen) {
            content.classList.add('open');
            btn.classList.add('active');
        }
    }

    // Render Supermarkets
    const marketContainer = document.getElementById('supermarket-container');
    supermarketData.forEach((grp, idx) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn market-btn';
        btn.innerHTML = `<span>${grp.hotel}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(idx, 'market-list', 'market-btn');
        marketContainer.appendChild(btn);

        const div = document.createElement('div');
        div.id = `market-list-${idx}`;
        div.className = 'collapse-content market-list';
        grp.shops.forEach(shop => {
            const item = document.createElement('div');
            item.className = 'market-item';
            item.onclick = () => openGoogleMap(shop.addr);
            item.innerHTML = `<span class="market-name">${shop.name}</span><span class="market-dist">${shop.dist}</span><div class="market-feature">${shop.feat}</div>`;
            div.appendChild(item);
        });
        marketContainer.appendChild(div);
    });

    // Render Souvenirs
    const souvenirContainer = document.getElementById('souvenir-container');
    souvenirData.forEach((cat, idx) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn souvenir-btn';
        btn.innerHTML = `<span>${cat.category}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(idx, 'souvenir-list', 'souvenir-btn');
        souvenirContainer.appendChild(btn);

        const div = document.createElement('div');
        div.id = `souvenir-list-${idx}`;
        div.className = 'collapse-content souvenir-list';
        cat.items.forEach(item => {
            const el = document.createElement('div');
            el.className = 'souvenir-item';
            el.onclick = () => openGoogleMap(`åšå¤šé§… ${item.loc} ${item.name.split('(')[0]}`);
            el.innerHTML = `<div><span class="souvenir-name">${item.name}</span><span class="souvenir-price">${item.price}</span></div><div class="souvenir-loc">${item.loc}</div><div class="souvenir-note">${item.note}</div>`;
            div.appendChild(el);
        });
        souvenirContainer.appendChild(div);
    });

    // Render Itinerary
    const itinDiv = document.getElementById('itinerary-content');
    itineraryData.forEach((day, idx) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn date-btn';
        btn.innerHTML = `<span>${day.date}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(idx, 'day-details', 'date-btn');
        itinDiv.appendChild(btn);

        const div = document.createElement('div');
        div.id = `day-details-${idx}`;
        div.className = 'collapse-content day-details';
        day.steps.forEach(s => {
            const step = document.createElement('div');
            step.className = 'timeline-step';
            
            // Check if step has custom HTML content (for Timetable or Taxi)
            if (s.isHtml) {
                step.innerHTML = `<div class="step-time">${s.t}</div><div class="step-content" onclick="openHtmlModal('${s.name}', this)" data-html="${encodeURIComponent(s.htmlContent)}" data-image="${s.image}"><div style="font-weight:bold;color:var(--text)">${s.name}</div><div style="font-size:0.85rem;color:#666;">${s.desc}</div></div>`;
            } else {
                step.innerHTML = `<div class="step-time">${s.t}</div><div class="step-content" onclick="openModal('${s.name}', '${s.image}', '${s.desc}')"><div style="font-weight:bold;color:var(--text)">${s.name}</div><div style="font-size:0.85rem;color:#666;">${s.desc}</div></div>`;
            }
            div.appendChild(step);
        });
        itinDiv.appendChild(div);
    });

    // Render Food
    const foodDiv = document.getElementById('food-container');
    foodData.forEach((cat, idx) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn food-region-btn';
        btn.innerHTML = `<span>${cat.region}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(idx, 'food-list', 'food-region-btn');
        foodDiv.appendChild(btn);

        const div = document.createElement('div');
        div.id = `food-list-${idx}`;
        div.className = 'collapse-content food-list';
        cat.items.forEach(i => {
            const name = i.split('(')[0];
            const query = `${cat.region} ${name}`;
            div.innerHTML += `<span class="food-tag" onclick="openGoogleMap('${query}')">${i} <i class="fas fa-location-arrow"></i></span>`;
        });
        foodDiv.appendChild(div);
    });

    // Render Reservations
    function renderRes(data, id) {
        const div = document.getElementById(id);
        data.forEach(r => {
            const el = document.createElement('div');
            el.className = 'step-content res-content';
            el.style.marginBottom = '10px';
            el.onclick = () => openModal(r.t, r.image, r.d);
            el.innerHTML = `<div style="font-weight:bold;color:var(--res)">${r.t}</div><div style="font-size:0.9rem;color:#555;">${r.d}</div>`;
            div.appendChild(el);
        });
    }
    renderRes(hotelRes, 'res-hotel-0');
    renderRes(otherRes, 'res-other-1');

    // Render Mapcodes
    function renderMaps(data, id) {
        const tbody = document.getElementById(id);
        data.forEach(m => {
            const tr = document.createElement('tr');
            // If it's a rest stop (has desc property), show description
            const descHtml = m.desc ? `<div style="font-size:0.8rem; color:#555; margin-top:4px;">${m.desc}</div>` : (m.n.includes("é˜¿è˜‡è·¯") ? `<div style="font-size:0.8rem; color:#888; margin-top:2px;">æ¨è–¦ï¼šé«˜èœé£¯ã€éºµç–™ç˜©æ±</div>` : "");
            
            tr.innerHTML = `<td><span class="map-link" onclick="openGoogleMap('${m.addr}')" style="cursor:pointer">${m.n} <i class="fas fa-external-link-alt"></i></span>${descHtml}</td><td><div style="font-weight:bold;color:var(--ocean-dark)">${m.c} <button class="copy-btn" onclick="copy('${m.c}')">è¤‡è£½</button></div><div style="font-size:0.85rem;color:#666">${m.p} <button class="copy-btn" onclick="copy('${m.p}')">è¤‡è£½</button></div></td>`;
            tbody.appendChild(tr);
        });
    }
    renderMaps(mapMountain, 'map-body-1');
    renderMaps(mapOcean, 'map-body-2');
    renderMaps(mapHotels, 'map-body-3');
    renderMaps(mapRest, 'map-body-4');

    function switchMapTab(p) {
        document.querySelectorAll('.map-tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.map-tab-btn')[p-1].classList.add('active');
        document.getElementById('map-page-1').style.display = p===1 ? 'block' : 'none';
        document.getElementById('map-page-2').style.display = p===2 ? 'block' : 'none';
        document.getElementById('map-page-3').style.display = p===3 ? 'block' : 'none';
        document.getElementById('map-page-4').style.display = p===4 ? 'block' : 'none';
    }

    // Checklist
    const packDiv = document.getElementById('checklist-container');
    const packingList = ["è­·ç…§", "é§•ç…§+è­¯æœ¬", "ä¿¡ç”¨å¡(å¯Œé‚¦J)", "æ—¥å¹£", "æ‰‹æ©Ÿ+å……é›»å™¨", "è¡Œå‹•é›»æº", "eSIM", "ä¿æº«ç“¶", "æ°´æ¯", "ç‰™åˆ·", "é›¨å…·", "å¸¸å‚™è—¥", "ç›Šç”ŸèŒ", "åˆ®é¬åˆ€"];
    packingList.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'checklist-item';
        if(localStorage.getItem('pack_'+idx) === 'true') div.classList.add('checked');
        div.innerHTML = `<input type="checkbox" ${div.classList.contains('checked')?'checked':''} onchange="toggleCheck(this,${idx})"><span>${item}</span>`;
        packDiv.appendChild(div);
    });
    function toggleCheck(el, idx) {
        el.parentElement.classList.toggle('checked');
        localStorage.setItem('pack_'+idx, el.checked);
    }

    // Modal
    const modal = document.getElementById('location-modal');
    function openModal(t, src, d) {
        document.getElementById('modal-title').innerText = t;
        document.getElementById('modal-desc').innerText = d;
        const img = document.getElementById('modal-img');
        img.style.display = 'block';
        img.src = src;
        modal.classList.add('open');
    }
    
    // New function for HTML content modal (Timetable & Taxi)
    function openHtmlModal(t, el) {
        const htmlContent = decodeURIComponent(el.getAttribute('data-html'));
        const imageSrc = el.getAttribute('data-image');
        
        document.getElementById('modal-title').innerText = t;
        document.getElementById('modal-desc').innerHTML = htmlContent;
        
        const img = document.getElementById('modal-img');
        if(imageSrc && imageSrc !== 'null' && imageSrc !== 'undefined' && imageSrc !== '') {
            img.style.display = 'block';
            img.src = imageSrc;
        } else {
            img.style.display = 'none';
        }
        
        modal.classList.add('open');
    }

    function closeModal(e) {
        if(e.target === modal || e.target.classList.contains('close-modal')) modal.classList.remove('open');
    }

    // Calculator
    const jpyIn = document.getElementById('jpy-input');
    const rateIn = document.getElementById('rate-input');
    const twdOut = document.getElementById('twd-output');
    function calc() {
        twdOut.innerText = Math.round((parseFloat(jpyIn.value)||0) * (parseFloat(rateIn.value)||0)).toLocaleString();
    }
    if(jpyIn) {
        jpyIn.addEventListener('input', calc);
        rateIn.addEventListener('input', calc);
        fetch('https://api.exchangerate-api.com/v4/latest/JPY').then(r=>r.json()).then(d=>{ if(d.rates.TWD) { rateIn.value=d.rates.TWD; calc(); }});
    }

    function copy(txt) { navigator.clipboard.writeText(txt).then(() => alert('å·²è¤‡è£½: '+txt)); }
</script>
</body>
</html>
