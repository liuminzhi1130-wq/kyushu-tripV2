<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¥æ—¥åºæ›²ï½œä¹å·å±±æµ·è‡ªé§•æ—¥è¨˜ ğŸŒ¸</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap');

        :root {
            --plum: #F06292;        /* æ¢…èŠ±ä¸»è‰² */
            --plum-light: #FCE4EC;
            --ocean: #29B6F6;       /* æµ·æ´‹è— */
            --ocean-dark: #0277BD;
            --mountain: #9CCC65;    /* é˜¿è˜‡ç¶  */
            --text: #37474F;
            --glass: rgba(255, 255, 255, 0.93);
            --gift: #FF9800;        /* ä¼´æ‰‹ç¦®æ©˜ */
            --coupon: #E91E63;      /* å„ªæƒ åˆ¸ç´… */
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background: linear-gradient(160deg, #E1F5FE 0%, #F3E5F5 50%, #F1F8E9 100%);
            margin: 0;
            padding: 20px;
            color: var(--text);
            min-height: 100vh;
            background-attachment: fixed;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--glass);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.6);
            padding-bottom: 30px;
        }

        /* --- Header: æ¢…èŠ±èƒŒæ™¯ --- */
        header {
            background-image: url('https://images.unsplash.com/photo-1522383225653-ed111181a951?q=80&w=2076&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            height: 200px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.4);
            backdrop-filter: blur(1px);
        }

        .header-text {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            color: #D81B60;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.9);
            letter-spacing: 3px;
            font-weight: 800;
        }

        /* Navigation Grid */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
        }

        .nav-btn {
            background: white;
            padding: 18px;
            border-radius: 16px;
            text-align: center;
            font-weight: bold;
            color: var(--text);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(240, 98, 146, 0.2);
            border-color: var(--plum-light);
        }

        .nav-btn i { font-size: 1.5rem; color: var(--plum); }

        /* Sections */
        .section { display: none; padding: 0 20px; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Back Button Style --- */
        .back-btn {
            background: white;
            border: 2px solid var(--ocean-dark);
            color: var(--ocean-dark);
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            width: 100%;
            box-sizing: border-box;
        }

        .back-btn:hover {
            background: var(--ocean-dark);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
        }
        
        h2 {
            font-size: 1.4rem;
            color: var(--plum);
            border-bottom: 2px dashed #ddd;
            padding-bottom: 10px;
            margin-top: 0;
        }

        /* Coupon Styles */
        .coupon-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 2px dashed var(--coupon);
            position: relative;
        }
        
        .coupon-card::before {
            content: 'COUPON';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--coupon);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .coupon-img {
            width: 100%;
            height: 180px;
            object-fit: contain; /* å®Œæ•´é¡¯ç¤ºåœ–ç‰‡ */
            background: #fafafa;
            display: block;
            cursor: pointer;
        }
        
        .coupon-info {
            padding: 15px;
            text-align: center;
        }
        
        .coupon-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .coupon-desc {
            font-size: 0.9rem;
            color: #666;
        }

        /* Souvenir Card Styles */
        .parking-card {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 2px solid #ffb74d;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .parking-title { font-weight: bold; color: #e65100; margin-bottom: 5px; font-size: 1.1rem; }
        .parking-info { font-size: 0.9rem; color: #5d4037; line-height: 1.6; }

        .souvenir-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            border-left: 5px solid var(--gift);
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .souvenir-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.1);
            background: #fffcfd;
        }

        .souvenir-name { font-weight: bold; font-size: 1.05rem; color: #333; margin-bottom: 4px; }
        .souvenir-price { color: #D81B60; font-weight: bold; font-size: 0.9rem; margin-left: 8px; }
        .souvenir-loc { font-size: 0.85rem; color: #666; margin-bottom: 2px; }
        .souvenir-note { font-size: 0.8rem; color: #888; font-style: italic; }
        .souvenir-item::after { content: '\f3c5'; font-family: "Font Awesome 5 Free"; font-weight: 900; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--gift); font-size: 1.2rem; opacity: 0.5; }


        /* Calculator Styles */
        .calc-card {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .calc-input-group { margin-bottom: 20px; text-align: left; }
        .calc-label { font-size: 0.9rem; color: #888; margin-bottom: 5px; display: block; font-weight: bold; }
        .calc-input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 1.2rem; font-family: inherit; box-sizing: border-box; outline: none; transition: 0.2s; }
        .calc-input:focus { border-color: var(--ocean); }
        
        .calc-result {
            background: linear-gradient(135deg, var(--plum-light), #fff0f5);
            padding: 20px;
            border-radius: 15px;
            margin-top: 10px;
            border: 2px solid var(--plum);
        }
        .twd-amount { font-size: 2.5rem; font-weight: 800; color: #D81B60; margin: 10px 0; }

        /* Food Link Styles */
        .food-tag {
            background: white;
            padding: 10px 14px;
            border-radius: 20px;
            font-size: 0.95rem;
            margin: 0 6px 10px 0;
            display: inline-block;
            border: 1px solid #eee;
            text-decoration: none;
            color: var(--text);
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
            border-left: 4px solid var(--plum);
        }
        .food-tag:hover { background: var(--plum-light); color: #D81B60; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(240, 98, 146, 0.2); }
        .food-tag i { margin-left: 5px; font-size: 0.8rem; color: #aaa; }

        /* Styles for Collapsible Buttons */
        .collapse-btn {
            width: 100%;
            background: white;
            border: none;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            text-align: left;
            font-family: inherit;
            font-size: 1.05rem;
            font-weight: bold;
            color: var(--text);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.2s;
        }
        .date-btn { border-left: 5px solid var(--ocean); }
        .food-region-btn { border-left: 5px solid var(--plum); }
        .souvenir-btn { border-left: 5px solid var(--gift); }

        .collapse-btn:hover { background: #f8fcfd; }
        .collapse-btn.active { background: var(--plum-light); color: #D81B60; }
        
        .collapse-content { display: none; padding: 10px 5px; margin-bottom: 15px; animation: slideDown 0.3s ease; }
        .collapse-content.open { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Timeline */
        .timeline-step { display: flex; margin-bottom: 15px; padding-left: 10px; position: relative; }
        .timeline-step::before { content: ''; position: absolute; left: 0; top: 8px; bottom: -20px; width: 2px; background: #eee; }
        .timeline-step:last-child::before { display: none; }
        .step-time { font-size: 0.8rem; color: #999; width: 50px; flex-shrink: 0; padding-top: 3px; font-weight: bold; }
        .step-content { background: white; padding: 12px 15px; border-radius: 12px; flex-grow: 1; box-shadow: 0 2px 8px rgba(0,0,0,0.03); border-left: 4px solid var(--mountain); cursor: pointer; transition: 0.2s; position: relative; }
        .step-content:active { transform: scale(0.98); background: #fafafa; }
        .step-content::after { content: 'ğŸ“¸'; font-size: 1rem; position: absolute; right: 10px; top: 12px; opacity: 0.6; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; backdrop-filter: blur(5px); }
        .modal.open { display: flex; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-card { background: white; width: 100%; max-width: 400px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.2); position: relative; }
        .modal-img { width: 100%; height: 100%; max-height: 400px; object-fit: contain; background: #222; display: block; } /* Updated for coupon view */
        .modal-body { padding: 20px; }
        .modal-title { font-size: 1.3rem; color: var(--ocean-dark); margin: 0 0 10px 0; font-weight: bold; }
        .modal-desc { font-size: 0.95rem; line-height: 1.6; color: #555; }
        .close-modal { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }

        /* Mapcode Pagination */
        .map-tabs { display: flex; background: #f0f0f0; border-radius: 10px; padding: 5px; margin-bottom: 20px; }
        .map-tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-weight: bold; color: #888; border-radius: 8px; transition: 0.3s; font-family: inherit; }
        .map-tab-btn.active { background: white; color: var(--ocean-dark); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .map-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        .map-table td { background: white; padding: 12px; border: 1px solid #eee; }
        
        .map-link { text-decoration: none; color: var(--ocean-dark); font-weight: bold; display: block; transition: color 0.2s; }
        .map-link:hover { color: var(--plum); }
        .map-link i { margin-left: 5px; font-size: 0.8rem; color: #aaa; }

        .map-table td:first-child { border-radius: 10px 0 0 10px; border-right: none; }
        .map-table td:last-child { border-radius: 0 10px 10px 0; border-left: none; text-align: right; }
        .copy-btn { background: var(--plum-light); color: var(--plum); border: none; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; cursor: pointer; }

        /* Checklist */
        .checklist-item { background: white; padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; align-items: center; border: 1px solid #f0f0f0; }
        .checklist-item input { margin-right: 15px; width: 20px; height: 20px; accent-color: var(--plum); }
        .checklist-item.checked span { text-decoration: line-through; color: #ccc; }

        /* Petals */
        .petal { position: fixed; background: #FFCDD2; width: 10px; height: 10px; border-radius: 100% 0 100% 0; pointer-events: none; animation: fall linear infinite; z-index: 9999; opacity: 0.6; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <div class="container">
        <header>
            <div class="header-text">
                <h1>æ˜¥æ—¥åºæ›²</h1>
            </div>
        </header>

        <div id="home" class="section active">
            <div class="nav-grid">
                <div class="nav-btn" onclick="showSection('itinerary')">
                    <i class="fas fa-map-marked-alt"></i> äº’å‹•è¡Œç¨‹è¡¨
                </div>
                <div class="nav-btn" onclick="showSection('packing')">
                    <i class="fas fa-suitcase"></i> æ—…è¡Œæ¸…å–®
                </div>
                <div class="nav-btn" onclick="showSection('food')">
                    <i class="fas fa-utensils"></i> ç¾é£Ÿåœ°åœ–
                </div>
                <div class="nav-btn" onclick="showSection('souvenirs')">
                    <i class="fas fa-gift"></i> ä¼´æ‰‹ç¦®æ¨è–¦
                </div>
                <div class="nav-btn" onclick="showSection('coupons')">
                    <i class="fas fa-ticket-alt"></i> å„ªæƒ åˆ¸
                </div>
                <div class="nav-btn" onclick="showSection('mapcodes')">
                    <i class="fas fa-car-side"></i> å°èˆªç·¨ç¢¼
                </div>
                <div class="nav-btn" onclick="showSection('reservations')">
                    <i class="fas fa-file-invoice"></i> é ç´„æ†‘è­‰
                </div>
                <div class="nav-btn" onclick="showSection('calculator')">
                    <i class="fas fa-calculator"></i> åŒ¯ç‡è¨ˆç®—
                </div>
                <div class="nav-btn" onclick="openGoogleMapSearch('é™„è¿‘è¶…å¸‚')">
                    <i class="fas fa-shopping-basket"></i> é™„è¿‘è¶…å¸‚
                </div>
            </div>
            <p style="text-align:center; color:#999; font-size:0.8rem; margin-top:10px;">
                *é»æ“Šè¡Œç¨‹è¡¨ä¸­çš„é …ç›®å¯æŸ¥çœ‹ç…§ç‰‡
            </p>
        </div>

        <div id="coupons" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸŸï¸ å„ªæƒ åˆ¸å°ˆå€</h2>
            
            <div class="coupon-card">
                <img src="å¤©è‰æµ·é®®è”µ.png" class="coupon-img" onclick="openModal('å¤©è‰æµ·é®®è”µ', 'å¤©è‰æµ·é®®è”µ.png', 'è«‹å‡ºç¤ºæ­¤åœ–ç‰‡çµ¦åº—å“¡ç¢ºèª')" onerror="this.src='https://via.placeholder.com/300x150?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';">
                <div class="coupon-info">
                    <div class="coupon-title">å¤©è‰æµ·é®®è”µ é ç´„æ†‘è­‰/å„ªæƒ </div>
                    <div class="coupon-desc">é»æ“Šåœ–ç‰‡å¯æ”¾å¤§æª¢è¦–</div>
                </div>
            </div>

            <div class="coupon-card" style="border-color: #ccc;">
                <div style="height:150px; display:flex; align-items:center; justify-content:center; background:#f0f0f0; color:#999;">
                    (THE OUTLETS å„ªæƒ åˆ¸é ç•™ä½) <br> è«‹æ”¾å…¥ outlet_coupon.jpg
                </div>
                <div class="coupon-info">
                    <div class="coupon-title">å…¶ä»–å„ªæƒ åˆ¸</div>
                    <div class="coupon-desc">å°‡åœ–ç‰‡èˆ‡ index.html æ”¾åœ¨åŒè³‡æ–™å¤¾å³å¯é¡¯ç¤º</div>
                </div>
            </div>
        </div>

        <div id="souvenirs" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ å¿…è²·ä¼´æ‰‹ç¦®æ¸…å–®</h2>
            
            <div class="parking-card">
                <div class="parking-title"><i class="fas fa-parking"></i> è‡ªé§•åœè»Šæ¨è–¦</div>
                <div class="parking-info">
                    <div style="font-weight:bold; margin-bottom:5px;">åšå¤šè»Šç«™ä¸­å¤®åœè»Šå ´</div>
                    <div>MapCode: <b>13 320 354*52</b> <button class="copy-btn" onclick="copy('13 320 354*52')">è¤‡è£½</button></div>
                    <div style="font-size:0.85rem; color:#888; margin:5px 0;">å„ªæƒ ï¼šæ¶ˆè²»æ»¿3000æ—¥åœ“å¯æŠµ1å°æ™‚</div>
                    <div style="margin-top:5px; text-align:right;">
                        <span class="map-link" onclick="openGoogleMapSearch('åšå¤šé§…ä¸­å¤®é§è»Šå ´')" style="cursor:pointer;">
                            Google Map å°èˆª <i class="fas fa-location-arrow"></i>
                        </span>
                    </div>
                </div>
            </div>

            <div id="souvenir-container"></div>
        </div>

        <div id="packing" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ’ å‡ºç™¼å‰æª¢æŸ¥</h2>
            <div id="checklist-container"></div>
        </div>

        <div id="calculator" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ’´ è³¼ç‰©è¨ˆç®—æ©Ÿ</h2>
            <div class="calc-card">
                <div style="margin-bottom:20px; text-align:left;">
                    <label class="calc-label">ç›®å‰åŒ¯ç‡ (å¯æ‰‹å‹•ä¿®æ”¹)</label>
                    <input type="number" id="rate-input" class="calc-input" value="0.22" step="0.001" style="width:100px; padding:8px;"> 
                    <span style="font-size:0.9rem; color:#888;">(1æ—¥å¹£ = ?å°å¹£)</span>
                </div>
                <div class="calc-input-group">
                    <label class="calc-label">æ—¥å¹£é‡‘é¡ (Â¥)</label>
                    <input type="number" id="jpy-input" class="calc-input" placeholder="è¼¸å…¥åƒ¹æ ¼...">
                </div>
                <div class="calc-result">
                    <div style="font-size:0.9rem; color:#666;">ç´„åˆå°å¹£ (TWD)</div>
                    <div class="twd-amount" id="twd-output">0</div>
                </div>
                <p style="font-size:0.8rem; color:#999; margin-top:15px;">*åŒ¯ç‡åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è«‹ä¾åˆ·å¡/æ›åŒ¯ç‚ºæº–</p>
            </div>
        </div>

        <div id="itinerary" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ“… é»æ“Šæ—¥æœŸå±•é–‹è¡Œç¨‹</h2>
            <div id="itinerary-content"></div>
        </div>

        <div id="food" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸœ é»æ“Šåº—å®¶å°èˆª</h2>
            <div id="food-container"></div>
        </div>

        <div id="mapcodes" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸš— é»æ“Šåœ°é»å°èˆª</h2>
            <div class="map-tabs">
                <button class="map-tab-btn active" onclick="switchMapTab(1)">ç¬¬ä¸€éƒ¨ï¼šå±±æ—ç¯‡</button>
                <button class="map-tab-btn" onclick="switchMapTab(2)">ç¬¬äºŒéƒ¨ï¼šæµ·æ´‹ç¯‡</button>
            </div>
            <div id="map-page-1">
                <table class="map-table"><tbody id="map-body-1"></tbody></table>
            </div>
            <div id="map-page-2" style="display:none;">
                <table class="map-table"><tbody id="map-body-2"></tbody></table>
            </div>
        </div>

        <div id="reservations" class="section">
            <button class="back-btn" onclick="showSection('home')"><i class="fas fa-chevron-left"></i> è¿”å›é¦–é </button>
            <h2>ğŸ« é ç´„ç¢ºèªè³‡æ–™</h2>
            <div id="res-container"></div>
        </div>
    </div>

    <div id="location-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-card">
            <button class="close-modal" onclick="closeModal(event)">Ã—</button>
            <img id="modal-img" class="modal-img" src="" alt="Location" onerror="this.style.display='none'">
            <div class="modal-body">
                <h3 id="modal-title" class="modal-title"></h3>
                <p id="modal-desc" class="modal-desc"></p>
            </div>
        </div>
    </div>

<script>
    // --- Helper for Google Maps Search (Fix for Android/iOS) ---
    function openGoogleMapSearch(query) {
        const encodedQuery = encodeURIComponent(query);
        // Using the standard Google Maps search URL which works best on mobile & desktop
        const url = `https://www.google.com/maps/search/?api=1&query=${encodedQuery}`;
        window.open(url, '_blank');
    }

    // --- Data Configuration ---

    // Souvenir Data (Grouped)
    const souvenirData = [
        {
            category: "ğŸ§‚ èª¿å‘³æ–™ / é¹¹é£Ÿé¡",
            items: [
                { name: "è»Ÿç®¡æ˜å¤ªå­é†¬", price: "Â¥756", loc: "Maing ååº—è¡— (ã‚„ã¾ã‚„/ãµãã‚„)", note: "éœ€æ‰˜é‹/å†·è—ï¼Œé…é£¯ç¥ç‰©" },
                { name: "èŒ…ä¹ƒèˆé«˜æ¹¯åŒ…", price: "Â¥2,268/30å…¥", loc: "Deitos 1F (Miyage-monå¸‚å ´)", note: "ç…®æ¹¯ç¥å™¨ï¼Œé€ç¦®é¦–é¸" },
                { name: "æ˜å¤ªå­ä»™è²", price: "Â¥540/16æš", loc: "Maing / Deitos", note: "ç¶“å…¸é¹¹é£Ÿï¼Œç¦å¤ªéƒå‡ºå“" },
                { name: "é’æŸšå­èƒ¡æ¤’", price: "Â¥432èµ·", loc: "Maing (å„åœŸç”¢åº—/è¶…å¸‚)", note: "æ²¾è‚‰çµ•é…" },
                { name: "Calbee ä¹å·æ˜å¤ªå­è–¯æ¢", price: "Â¥900/8è¢‹", loc: "Maing / è¶…å•†", note: "è¾¦å…¬å®¤åˆ†é£Ÿæ–¹ä¾¿" },
                { name: "å…«å¥³èŒ¶", price: "Â¥1,080/100g", loc: "Maing (å¦‚æ°´åºµ/èŒ¶åº—)", note: "ç¦å²¡é«˜ç´šç¶ èŒ¶" }
            ]
        },
        {
            category: "ğŸ° ç”œé» / è›‹ç³•é¡",
            items: [
                { name: "ç¦ç ‚å±‹ é•·å´è›‹ç³•", price: "Â¥1,458", loc: "Maing / Deitos", note: "åº•éƒ¨ç²—ç³–é¡†ç²’ï¼Œè³å‘³æœŸé™çŸ­" },
                { name: "åšå¤šé€šé¥…é ­", price: "Â¥730/5å…¥", loc: "Maing (æ˜æœˆå ‚)", note: "å¥¶é¦™æ¿ƒéƒï¼Œé€£çºŒé‡‘è³" },
                { name: "Sugar Butter Sand Tree", price: "Â¥993/10å…¥", loc: "åšå¤šé˜ªæ€¥ B1F", note: "åšå¤šé™å®šç”˜ç‹è‰è“å£å‘³" },
                { name: "ä¼Šéƒ½ King è‰è“éŠ…é‘¼ç‡’", price: "Â¥565/å€‹", loc: "Maing (ä¼Šéƒ½ãã‚“ã)", note: "å«æ•´é¡†è‰è“ï¼Œéœ€å†·è—" },
                { name: "å—è »å¾€ä¾†", price: "Â¥670/4å…¥", loc: "Maing", note: "é…¥è„†æä»è›‹ç³•ï¼Œåœ¨åœ°äººæ„›" },
                { name: "ç­‘ç´«éº»ç³¬", price: "Â¥540/3å…¥", loc: "Maing (å¦‚æ°´åºµ)", note: "é™„é»‘ç³–èœœï¼Œç²¾ç·»åŒ…è£" },
                { name: "æ²»ä¸€éƒå¸ƒä¸", price: "Â¥420", loc: "JRåšå¤šåŸ 1F ã„ã£ã´ã‚“é€šã‚Š", note: "è›‹é¦™æ¿ƒéƒå£æ„Ÿç¶¿å¯†ï¼Œéœ€å†·è—" }
            ]
        },
        {
            category: "ğŸª é¤…ä¹¾ / å°é»å¿ƒ",
            items: [
                { name: "äºŒâ—‹åŠ ç…é¤…", price: "Â¥648/3æš", loc: "Maing (æ±é›²å ‚)", note: "é™„æç¬‘é¢å…·" },
                { name: "Tirolian æ²å¿ƒé…¥", price: "Â¥540/åŒ…", loc: "Maing (åƒé³¥å±‹)", note: "å¾©å¤éµç½å¯æ„›" },
                { name: "åšå¤šç”œè–¯ç‡’", price: "Â¥648/4å…¥", loc: "Maing (äºŒé¶´å ‚)", note: "ç¶¿å¯†åœ°ç“œå£æ„Ÿ" },
                { name: "åšå¤šç´…è‰è“é¤…ä¹¾", price: "Â¥777/10å…¥", loc: "Maing", note: "è‰è“å·§å…‹åŠ›å¤¾å¿ƒ" },
                { name: "å°é›é¥…é ­", price: "Â¥1,194/7å…¥", loc: "Maing (ã²ã‚ˆå­æœ¬èˆ—)", note: "ç¶“å…¸ä¼´æ‰‹ç¦®" },
                { name: "åšå¤šä¹‹å¥³", price: "Â¥389/6å…¥", loc: "Maing (äºŒé¶´å ‚)", note: "å°å¹´è¼ªè›‹ç³•" }
            ]
        }
    ];

    const itineraryData = [
        {
            date: "1/29 (å››) Day 1",
            steps: [
                { t: "12:00", name: "ç¦å²¡æ©Ÿå ´ (FUK)", image: "day1_airport.jpg", desc: "æŠµé”ç¦å²¡ï¼CI138 èˆªç­ã€‚å‡ºé—œå¾Œæ­è¨ˆç¨‹è»Šæˆ–åœ°éµå‰å¾€åšå¤šå¸‚å€ã€‚" },
                { t: "14:00", name: "å·ç«¯é€šå•†åº—è¡—", image: "day1_kawabata.jpg", desc: "åšå¤šæœ€å¤è€çš„å•†åº—è¡—ï¼Œæœ‰å„å¼å°åƒèˆ‡ä¼´æ‰‹ç¦®ã€‚å¿…é€›ï¼" },
                { t: "15:00", name: "Full Full æ˜å¤ªå­éºµåŒ…", image: "day1_fullfull.jpg", desc: "é›–ç„¶æœ¬åº—äººå¤šï¼Œä½†é€™å®¶æ˜å¤ªå­æ³•æ£æ˜¯å‚³èªªä¸­çš„ç¾å‘³ï¼Œå¤–é…¥å…§è»Ÿã€‚" },
                { t: "18:00", name: "è—¥é™¢ç‡’è‚‰ NIKUICHI", image: "day1_nikuichi.jpg", desc: "ã€å·²é ç´„ã€‘CPå€¼è¶…é«˜çš„é»‘æ¯›å’Œç‰›ç‡’è‚‰ï¼Œè‚‰è³ªé®®å«©ï¼Œè¨˜å¾—å‡ºç¤ºé ç´„ä¿¡ã€‚" },
                { t: "20:00", name: "è¥¿éµ Croom åšå¤šç¥‡åœ’", image: "day1_hotel.jpg", desc: "ã€ä½å®¿ã€‘ä½æ–¼æ«›ç”°ç¥ç¤¾å‰ï¼Œäº¤é€šæ–¹ä¾¿ï¼Œæœ‰å¤§æµ´å ´å¯ä»¥æ³¡æ¹¯ã€‚" }
            ]
        },
        {
            date: "1/30 (äº”) Day 2",
            steps: [
                { t: "10:35", name: "åšå¤šåŸ é ­æ­èˆ¹", image: "day2_ferry.jpg", desc: "æ­ä¹˜æ¸¡è¼ªå‰å¾€æµ·ä¹‹ä¸­é“ï¼Œäº«å—åšå¤šç£çš„æµ·é¢¨ï¼Œèˆ¹ç¨‹ç´„20åˆ†é˜ã€‚" },
                { t: "11:00", name: "æµ·ä¹‹ä¸­é“æµ·æ¿±å…¬åœ’", image: "day2_park.jpg", desc: "ç§Ÿè…³è¸è»Šæ¼«éŠï¼æœ‰æ°´è±šå›ã€è¢‹é¼ ï¼Œé‚„æœ‰ä¸€æœ›ç„¡éš›çš„èŠ±æµ·èˆ‡è‰åœ°ã€‚" },
                { t: "18:00", name: "åšå¤šé‹æ²³åŸ", image: "day2_canalcity.jpg", desc: "å¤§å‹è³¼ç‰©ä¸­å¿ƒï¼Œæ¯åŠå°æ™‚æœ‰æ°´èˆç§€ã€‚æ™šé¤æ¨è–¦æ‹‰éºµç«¶æŠ€å ´æˆ–ç‰›èˆŒã€‚" }
            ]
        },
        {
            date: "1/31 (å…­) Day 3",
            steps: [
                { t: "09:00", name: "Toyota Rent a Car", image: "day3_car.jpg", desc: "ã€å–è»Šã€‘åšå¤šç«™æ±å…¥å£åº—ã€‚æ–¹æ¡ˆå«é›ªèƒèˆ‡ETCã€‚è¨˜å¾—æª¢æŸ¥è»Šæ³ã€‚" },
                { t: "11:30", name: "ULUU è‰è“åƒåˆ°é£½", image: "day3_strawberry.jpg", desc: "ã€å·²é ç´„ã€‘ä½è³€çš„å¤¢å¹»è‰è“åœ’ï¼Œå¤šå“ç¨®è‰è“ç¾æ¡ç¾åƒï¼Œç…‰ä¹³ç„¡é™åŠ ï¼" },
                { t: "15:00", name: "ç”±å¸ƒé™¢ æ¹¯ä¹‹åªè¡—é“", image: "day3_yufuin.jpg", desc: "ç«¥è©±èˆ¬çš„è¡—é“ï¼Œæœ‰å²åŠªæ¯”èŒ¶å±‹ã€B-Speakè›‹ç³•æ²ã€è±å¾Œç‰›å¯æ¨‚é¤…ã€‚" },
                { t: "18:30", name: "æ¹¯å¸ƒé™¢å±±æ°´é¤¨", image: "day3_sansuikan.jpg", desc: "ã€ä½å®¿ã€‘19:00å‰å¿…é ˆCheck-inï¼äº«å—éœ²å¤©æº«æ³‰èˆ‡æœƒå¸­æ–™ç†ï¼Œé‚„èƒ½çœ‹è¦‹ç”±å¸ƒå²³ã€‚" }
            ]
        },
        {
            date: "2/1 (æ—¥) Day 4",
            steps: [
                { t: "08:00", name: "é‡‘é±—æ¹–", image: "day4_lake.jpg", desc: "æ¸…æ™¨å¿…ä¾†ï¼æ¹–é¢é£„è‘—å¤¢å¹»çš„æ™¨éœ§ï¼Œæº«æ³‰æ°´èˆ‡å†·ç©ºæ°£äº¤ç¹”çš„å¥‡æ™¯ã€‚" },
                { t: "11:00", name: "é˜¿è˜‡è‰åƒé‡Œ", image: "day4_kusasenri.jpg", desc: "å»£é—Šçš„è‰åŸèˆ‡é¦¬åŒ¹ï¼ŒèƒŒæ™¯æ˜¯å†’ç…™çš„é˜¿è˜‡ç«å±±ï¼Œé¢¨æ™¯å£¯éº—ã€‚" },
                { t: "13:00", name: "é˜¿è˜‡èµ¤ç‰›ä¸¼", image: "day4_beef.jpg", desc: "åˆé¤æ¨è–¦ Imakin é£Ÿå ‚æˆ–ä¼‘æ¯ç«™ï¼ŒåŠç†Ÿç´…ç‰›è‚‰é‹ªæ»¿æ•´ç¢—é£¯ï¼" },
                { t: "19:00", name: "Dormy Inn Kumamoto", image: "day4_dormy.jpg", desc: "ã€ä½å®¿ã€‘ä½æ–¼ç†Šæœ¬å¸‚å€è¾›å³¶ç”ºï¼Œé ‚æ¨“æœ‰å¤©ç„¶æº«æ³‰ï¼Œå®µå¤œæœ‰å…è²»æ‹‰éºµã€‚" }
            ]
        },
        {
            date: "2/2 (ä¸€) Day 5",
            steps: [
                { t: "11:30", name: "å¤©è‰æµ·é®®è”µ (æµ·è±š)", image: "day5_dolphin.jpg", desc: "ã€å·²é ç´„ã€‘æ­èˆ¹å‡ºæµ·çœ‹é‡ç”Ÿæµ·è±šï¼Œæ©Ÿç‡é«˜é”98%ï¼åˆé¤äº«ç”¨æµ·é®®BBQã€‚" },
                { t: "18:00", name: "ç†Šæœ¬ ä¸‹é€šå•†åº—è¡—", image: "day5_shopping.jpg", desc: "ç†Šæœ¬æœ€ç†±é¬§çš„é€›è¡—è–åœ°ï¼Œè—¥å¦ã€æœé£¾ã€é¤å»³æ‡‰æœ‰ç›¡æœ‰ã€‚" }
            ]
        },
        {
            date: "2/3 (äºŒ) Day 6",
            steps: [
                { t: "10:00", name: "ç†Šæœ¬åŸ & åŸå½©è‹‘", image: "day6_castle.jpg", desc: "æ—¥æœ¬ä¸‰å¤§ååŸä¹‹ä¸€ï¼Œé»‘è‰²å¤©å®ˆé–£éå¸¸å¸¥æ°£ã€‚åŸå½©è‹‘æœ‰å¾ˆå¤šç†Šæœ¬ç‰¹è‰²å°åƒã€‚" },
                { t: "15:00", name: "å¤ªå®°åºœå¤©æ»¿å®®", image: "day6_dazaifu.jpg", desc: "å­¸å•ä¹‹ç¥ï¼Œåƒé“ä¸Šæœ‰éšˆç ”å¾è¨­è¨ˆçš„æ˜Ÿå·´å…‹ï¼Œå¿…åƒç¾çƒ¤æ¢…æé¤…ã€‚" },
                { t: "19:00", name: "ä¸‰äº•èŠ±åœ’é£¯åº—ä¸­æ´²", image: "day6_hotel.jpg", desc: "ã€ä½å®¿ã€‘æœ€å¾Œä¸‰æ™šçš„å®¶ï¼Œè³ªæ„Ÿè¨­è¨ˆï¼Œäº¤é€šæ–¹ä¾¿ï¼Œè¿‘ä¸­æ´²å±‹å°ã€‚" }
            ]
        },
        {
            date: "2/4 (ä¸‰) Day 7",
            steps: [
                { t: "09:00", name: "å‘¼å­æœå¸‚", image: "day7_squid.jpg", desc: "æ—¥æœ¬ä¸‰å¤§æœå¸‚ä¹‹ä¸€ï¼Œå¿…åƒã€Œé€æ˜æ´»èŠ±æåˆºèº«ã€ï¼Œå£æ„Ÿè„†ç”œï¼" },
                { t: "14:00", name: "ç³¸å³¶ å¤«å©¦å²©", image: "day7_itoshima.jpg", desc: "æµ·ä¸­ç™½è‰²é³¥å±…èˆ‡å¤«å©¦å²©ï¼Œç¦å²¡æœ€ç´…çš„ç¶²ç¾æ‰“å¡é»ï¼Œæµ·æ™¯ç„¡æ•µã€‚" }
            ]
        },
        {
            date: "2/5 (å››) Day 8",
            steps: [
                { t: "All Day", name: "THE OUTLETS", image: "day8_outlets.jpg", desc: "åŒ—ä¹å·æœ€å¤§Outletï¼Œå„å¼å“ç‰Œç˜‹ç‹‚æ¡è³¼ï¼Œç‚ºæ—…ç¨‹ç•«ä¸‹å®Œç¾å¥é»ã€‚" },
                { t: "18:00", name: "é‚„è»Š (Toyota)", image: "day8_returncar.jpg", desc: "å›åˆ°åšå¤šç«™æ±å…¥å£é‚„è»Šï¼Œè¨˜å¾—åŠ æ»¿æ²¹ä¸¦ä¿ç•™æ”¶æ“šã€‚" }
            ]
        },
        {
            date: "2/6 (äº”) Day 9",
            steps: [
                { t: "ä¸Šåˆ", name: "å‰å¾€æ©Ÿå ´", image: "day9_home.jpg", desc: "æ­è¨ˆç¨‹è»Šå‰å¾€ç¦å²¡æ©Ÿå ´ï¼Œæº–å‚™æ­ä¹˜ CI139 å›å®¶ã€‚" }
            ]
        }
    ];

    // --- Updated Packing List (Added Power Bank) ---
    const packingList = ["è­·ç…§ (æ•ˆæœŸå…§)", "å°ç£é§•ç…§ (æ­£æœ¬)", "é§•ç…§æ—¥æ–‡è­¯æœ¬", "å¯Œé‚¦Jå¡", "æ—¥å¹£ç¾é‡‘", "æ‰‹æ©Ÿ & å……é›»å™¨", "è¡Œå‹•é›»æº", "eSIM", "ä¿æº«ç“¶", "ç‰™åˆ·ç‰™è†", "é›¨å…·"];
    
    // --- Food Data ---
    const foodData = [
        { 
            region: "åšå¤š", 
            items: [
                "Full Full æ˜å¤ªå­éºµåŒ…", 
                "è—¥é™¢ç‡’è‚‰ NIKUICHI", 
                "ä¸€é›™æ‹‰éºµ (æ³¡ç³»è±šéª¨)",
                "å‰å¡šé°»é­šå±‹ (å¿…åƒè€åº—)",
                "åŠªåŠªé› (å†·ç‚¸é›)",
                "åšå¤šä¸€å£é¤ƒå­ å®é›²äº­",
                "ã¨ã‚Šã‹ã‚å¤§è‡£ (é›çš®ä¸²ç‡’)"
            ] 
        },
        { 
            region: "å¤©ç¥", 
            items: [
                "I'm donut? (ç”Ÿç”œç”œåœˆ)", 
                "Shin Shin æ‹‰éºµ", 
                "è‘«è˜†å£½å¸ (è¿´è½‰å£½å¸)",
                "å…ƒç¥–åšå¤šã‚ã‚“ãŸã„é‡ (æ˜å¤ªå­é£¯)",
                "å£½å¸éƒ å¤©ç¥åº— (é«˜CPå€¼)",
                "æ•˜æ•˜è‹‘ éŠç„äº­ (æ™¯è§€ç‡’è‚‰)",
                "BAKE CHEESE TART å¤©ç¥åœ°ä¸‹è¡—"
            ] 
        },
        { 
            region: "ç”±å¸ƒé™¢", 
            items: [
                "B-Speak è›‹ç³•æ²", 
                "è±å¾Œç‰›å¯æ¨‚é¤…", 
                "é‡œé£¯å¿ƒ (æ’éšŠååº—)",
                "Milch ç”±å¸ƒé™¢ (åŠç†Ÿèµ·å¸è›‹ç³•)",
                "èŠ±éº´èŠå®¶ (å¸ƒä¸éŠ…é‘¼ç‡’)",
                "é‡‘è³å¯æ¨‚é¤…",
                "telato (æ¿ƒæŠ¹èŒ¶å†°æ·‡æ·‹)"
            ] 
        },
        { 
            region: "ç†Šæœ¬", 
            items: [
                "é»‘äº­æ‹‰éºµ (ç„¦è’œæ²¹)", 
                "å‹çƒˆäº­ç‚¸è±¬æ’ (é¹¿å…’å³¶é»‘è±š)", 
                "èœ‚æ¨‚é¥…é ­ (åœ¨åœ°ç”œé»)",
                "è…ä¹ƒå±‹ (é¦¬è‚‰æ–™ç†å°ˆé–€åº—)",
                "ç´…è˜­äº­ (å¤ªå¹³ç‡•)",
                "æ‘ä¸Šã‚«ãƒ©ã‚·ãƒ¬ãƒ³ã‚³ãƒ³ (èŠ¥æœ«è“®è—•)",
                "é•·å£½åºµ (ã„ããªã‚Šå›£å­)"
            ] 
        },
        { 
            region: "é˜¿è˜‡/ä½è³€", 
            items: [
                "Imakin é£Ÿå ‚ (èµ¤ç‰›ä¸¼)", 
                "å‘¼å­æ´»èŠ±æåˆºèº« (æ²³å¤ªéƒ)", 
                "ç³¸å³¶å¸ƒä¸ (æµ·é‚Šå’–å•¡å»³)",
                "é˜¿è˜‡ã¨ã‚Šå®® (é¦¬è‚‰å¯æ¨‚é¤…)",
                "ä½è³€ç‰›é¤å»³ å­£æ¨‚ (é«˜ç´šä½è³€ç‰›)",
                "é«˜æ£®ç”°æ¥½ä¿å­˜ä¼š (åœçˆè£ç‡’çƒ¤)",
                "å¬‰é‡æº«æ³‰ å®—åºµæ©«é•· (æ¹¯è±†è…)"
            ] 
        }
    ];
    
    // --- Mapcode Data ---
    // [FIX] Updated Address for ULUU (Fully Corrected)
    const mapcodeData = [
        { n: "Toyota Rent a Car (åšå¤šç«™æ±)", c: "13 320 188*71", p: "092-472-8388", addr: "1 Chome-4-10 Toko, Hakata Ward, Fukuoka, 812-0008æ—¥æœ¬" },
        { n: "Uluu Gardens SAGA (è‰è“åœ’)", c: "37 491 662*13", p: "080-8956-1030", addr: "Uluu Gardens SAGA ä½è³€çœŒä¸‰é¤ŠåŸºéƒ¡ã¿ã‚„ãç”ºæ±Ÿå£7079" },
        { n: "æ¹¯å¸ƒé™¢å±±æ°´é¤¨", c: "269 328 633*45", p: "0977-84-2101", addr: "Yufuin Sansuikan" },
        { n: "é‡‘é±—æ¹–åœè»Šå ´", c: "269 359 583*03", p: "0977-84-3111", addr: "Kinrin Lake Parking" },
        { n: "é˜¿è˜‡è‰åƒé‡Œ", c: "256 456 770*85", p: "0967-34-0131", addr: "Kusasenri Observatory" },
        { n: "é˜¿è˜‡ä¸­å²³ç«å±±å£", c: "256 458 600*30", p: "0967-34-1600", addr: "Mount Aso Nakadake Crater" }, 
        { n: "Imakin é£Ÿå ‚", c: "256 685 024*41", p: "0967-32-0031", addr: "Imakin Shokudo" },
        { n: "Dormy Inn ç†Šæœ¬", c: "29 459 468*88", p: "096-311-5489", addr: "Dormy Inn Kumamoto Natural Hot Spring" },
        { n: "å¤©è‰æµ·é®®è”µ", c: "474 084 158*44", p: "0969-52-7707", addr: "Amakusa Kaisenkura" },
        { n: "ç†Šæœ¬åŸ", c: "29 459 342*58", p: "096-352-5900", addr: "Kumamoto Castle" },
        { n: "å¤ªå®°åºœå¤©æ»¿å®®", c: "55 364 128*71", p: "092-922-8225", addr: "Dazaifu Tenmangu" },
        { n: "å‘¼å­æœå¸‚", c: "182 722 104*50", p: "0955-82-3426", addr: "Yobuko Morning Market" },
        { n: "ç³¸å³¶ å¤«å©¦å²©", c: "224 788 206*25", p: "092-327-0317", addr: "Sakurai Futamigaura of Itoshima" },
        { n: "THE OUTLETS", c: "16 427 590*78", p: "093-663-7251", addr: "THE OUTLETS KITAKYUSHU" }
    ];
    const reservationData = [
        { t: "æ©Ÿç¥¨ (CI138/139)", d: "1/29 08:25 å» | 2/6 11:40 å›" },
        { t: "ç§Ÿè»Š (Toyota)", d: "1/31 - 2/5 åšå¤šç«™æ±å…¥å£" },
        { t: "è‰è“åƒåˆ°é£½ (ULUU)", d: "1/31 11:30" },
        { t: "è—¥é™¢ç‡’è‚‰ NIKUICHI", d: "1/29 æ™šé¤" },
        { t: "å¤©è‰æµ·è±š (æµ·é®®è”µ)", d: "2/2 11:30" },
        { t: "æ¹¯å¸ƒé™¢å±±æ°´é¤¨", d: "1/31 (éœ€ 19:00 å‰æŠµé”)" }
    ];

    // --- Logic ---

    function showSection(id) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }

    // Calculator Logic
    const jpyInput = document.getElementById('jpy-input');
    const rateInput = document.getElementById('rate-input');
    const twdOutput = document.getElementById('twd-output');

    function calculate() {
        const jpy = parseFloat(jpyInput.value) || 0;
        const rate = parseFloat(rateInput.value) || 0;
        const twd = Math.round(jpy * rate);
        twdOutput.innerText = twd.toLocaleString();
    }

    if(jpyInput) {
        jpyInput.addEventListener('input', calculate);
        rateInput.addEventListener('input', calculate);
        // Auto-fetch Exchange Rate (API)
        fetch('https://api.exchangerate-api.com/v4/latest/JPY')
            .then(response => response.json())
            .then(data => {
                if(data && data.rates && data.rates.TWD) {
                    rateInput.value = data.rates.TWD;
                    calculate();
                }
            })
            .catch(err => console.log('Rate fetch failed, using default'));
    }

    // Itinerary Rendering
    const itinDiv = document.getElementById('itinerary-content');
    itineraryData.forEach((day, index) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn date-btn';
        btn.innerHTML = `<span>${day.date}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(index, 'day-details', 'date-btn');
        itinDiv.appendChild(btn);

        const details = document.createElement('div');
        details.id = `day-details-${index}`;
        details.className = 'collapse-content day-details';
        
        const stepsHtml = day.steps.map(s => `
            <div class="timeline-step">
                <div class="step-time">${s.t}</div>
                <div class="step-content" onclick="openModal('${s.name}', '${s.image}', '${s.desc}')">
                    <div style="font-weight:bold; color:var(--text)">${s.name}</div>
                    <div style="font-size:0.85rem; color:#666; margin-top:2px;">${s.desc}</div>
                </div>
            </div>
        `).join('');
        
        details.innerHTML = stepsHtml;
        itinDiv.appendChild(details);
    });

    // Food Rendering
    const foodDiv = document.getElementById('food-container');
    foodData.forEach((cat, index) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn food-region-btn';
        btn.innerHTML = `<span><i class="fas fa-map-marker-alt"></i> ${cat.region}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(index, 'food-list', 'food-region-btn');
        foodDiv.appendChild(btn);

        const listDiv = document.createElement('div');
        listDiv.id = `food-list-${index}`;
        listDiv.className = 'collapse-content food-list';
        
        const itemsHtml = cat.items.map(i => {
            const cleanName = i.split('(')[0].trim();
            const query = `${cat.region} ${cleanName}`;
            return `<span class="food-tag" onclick="openGoogleMapSearch('${query}')">${i} <i class="fas fa-location-arrow"></i></span>`;
        }).join('');
        
        listDiv.innerHTML = itemsHtml;
        foodDiv.appendChild(listDiv);
    });

    // Souvenir Rendering (Accordion)
    const souvenirContainer = document.getElementById('souvenir-container');
    souvenirData.forEach((cat, index) => {
        const btn = document.createElement('button');
        btn.className = 'collapse-btn souvenir-btn';
        btn.innerHTML = `<span>${cat.category}</span> <i class="fas fa-chevron-down"></i>`;
        btn.onclick = () => toggleAccordion(index, 'souvenir-list', 'souvenir-btn');
        souvenirContainer.appendChild(btn);

        const listDiv = document.createElement('div');
        listDiv.id = `souvenir-list-${index}`;
        listDiv.className = 'collapse-content souvenir-list';

        cat.items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'souvenir-item';
            const query = `åšå¤šé§… ${item.loc} ${item.name.split('(')[0]}`;
            
            itemDiv.onclick = () => openGoogleMapSearch(query);
            itemDiv.innerHTML = `
                <div><span class="souvenir-name">${item.name}</span><span class="souvenir-price">${item.price}</span></div>
                <div class="souvenir-loc"><i class="fas fa-map-marker-alt"></i> ${item.loc}</div>
                <div class="souvenir-note">${item.note}</div>
            `;
            listDiv.appendChild(itemDiv);
        });
        souvenirContainer.appendChild(listDiv);
    });

    // General Accordion Toggle Function
    function toggleAccordion(index, contentClass, btnClass) {
        const targetContent = document.getElementById(`${contentClass}-${index}`);
        const targetBtn = document.getElementsByClassName(btnClass)[index];
        const isOpen = targetContent.classList.contains('open');

        // Close all of the same type
        document.querySelectorAll(`.${contentClass}`).forEach(el => el.classList.remove('open'));
        document.querySelectorAll(`.${btnClass}`).forEach(el => el.classList.remove('active'));

        // Toggle clicked
        if (!isOpen) {
            targetContent.classList.add('open');
            targetBtn.classList.add('active');
        }
    }

    // Modal Logic
    const modal = document.getElementById('location-modal');
    function openModal(title, imgSrc, desc) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-desc').innerText = desc;
        const imgEl = document.getElementById('modal-img');
        imgEl.style.display = 'block';
        imgEl.src = imgSrc;
        modal.classList.add('open');
    }
    
    function closeModal(e) {
        if(e.target === modal || e.target.classList.contains('close-modal')) {
            modal.classList.remove('open');
        }
    }

    // Render Checklist
    const checklistDiv = document.getElementById('checklist-container');
    packingList.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'checklist-item';
        const isChecked = localStorage.getItem(`pack_${idx}`) === 'true';
        if(isChecked) div.classList.add('checked');
        div.innerHTML = `<input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggleCheck(this, ${idx})"><span>${item}</span>`;
        checklistDiv.appendChild(div);
    });
    function toggleCheck(el, idx) {
        el.parentElement.classList.toggle('checked');
        localStorage.setItem(`pack_${idx}`, el.checked);
    }

    // Render Mapcodes with Links
    const splitIndex = mapcodeData.findIndex(item => item.n.includes("é˜¿è˜‡ä¸­å²³ç«å±±å£"));
    const mapPart1 = mapcodeData.slice(0, splitIndex + 1);
    const mapPart2 = mapcodeData.slice(splitIndex + 1);

    function renderMapRows(data, containerId) {
        const tbody = document.getElementById(containerId);
        data.forEach(item => {
            const tr = document.createElement('tr');
            // Prioritize specific Japanese address if available, else name
            const searchKey = item.addr ? item.addr : item.n;
            
            tr.innerHTML = `
                <td>
                    <span class="map-link" onclick="openGoogleMapSearch('${searchKey}')" style="cursor:pointer;">
                        ${item.n} <i class="fas fa-external-link-alt"></i>
                    </span>
                </td>
                <td>
                    <div style="color:var(--ocean-dark); font-weight:bold; font-family:monospace; font-size:1.1rem;">
                        ${item.c} <button class="copy-btn" onclick="copy('${item.c}')">è¤‡è£½</button>
                    </div>
                    <div style="font-size:0.85rem; color:#666; margin-top:4px;">
                        ğŸ“ ${item.p} <button class="copy-btn" onclick="copy('${item.p}')">è¤‡è£½</button>
                    </div>
                </td>`;
            tbody.appendChild(tr);
        });
    }
    renderMapRows(mapPart1, 'map-body-1');
    renderMapRows(mapPart2, 'map-body-2');

    function switchMapTab(page) {
        document.querySelectorAll('.map-tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.map-tab-btn')[page-1].classList.add('active');
        document.getElementById('map-page-1').style.display = page === 1 ? 'block' : 'none';
        document.getElementById('map-page-2').style.display = page === 2 ? 'block' : 'none';
    }
    function copy(txt) { navigator.clipboard.writeText(txt).then(() => alert('å·²è¤‡è£½ï¼š' + txt)); }

    // Render Reservations
    const resDiv = document.getElementById('res-container');
    reservationData.forEach(res => {
        const div = document.createElement('div');
        div.className = 'step-content';
        div.style.marginBottom = '10px';
        div.style.borderLeftColor = 'var(--mountain)';
        div.innerHTML = `<div style="font-weight:bold; color:var(--ocean-dark)">${res.t}</div><div style="font-size:0.9rem; color:#555;">${res.d}</div>`;
        resDiv.appendChild(div);
    });

    // Petals
    function createPetal() {
        const petal = document.createElement('div');
        petal.className = 'petal';
        petal.style.left = Math.random() * 100 + 'vw';
        petal.style.animationDuration = Math.random() * 3 + 4 + 's';
        document.body.appendChild(petal);
        setTimeout(() => petal.remove(), 7000);
    }
    setInterval(createPetal, 600);

</script>
</body>
</html>
